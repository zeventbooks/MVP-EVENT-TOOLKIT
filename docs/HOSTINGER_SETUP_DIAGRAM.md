# Hostinger Multi-Site Architecture Diagram

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USERS / CLIENTS                                  â”‚
â”‚                                                                          â”‚
â”‚  Tenant: root, abc, cbc, cbl                                            â”‚
â”‚  Pages: status, admin, events, display, sponsor, public                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           HTTPS Request with Query Params          â”‚
        â”‚                                                    â”‚
        â”‚  ?p=admin&tenant=root                             â”‚
        â”‚  ?p=events&tenant=abc                             â”‚
        â”‚  ?p=status&tenant=cbc                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   QA ENVIRONMENT      â”‚      â”‚ PRODUCTION ENVIRONMENT â”‚
        â”‚                       â”‚      â”‚                        â”‚
        â”‚ qa.zeventbooks.com    â”‚      â”‚  zeventbooks.com       â”‚
        â”‚                       â”‚      â”‚                        â”‚
        â”‚ SSL: âœ… Let's Encrypt â”‚      â”‚ SSL: âœ… Let's Encrypt  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Hostinger Server     â”‚      â”‚  Hostinger Server      â”‚
        â”‚  (SAME PHYSICAL HOST) â”‚      â”‚  (SAME PHYSICAL HOST)  â”‚
        â”‚                       â”‚      â”‚                        â”‚
        â”‚  Directory:           â”‚      â”‚  Directory:            â”‚
        â”‚  /qa.zeventbooks.com/ â”‚      â”‚  /public_html/         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    .htaccess          â”‚      â”‚    .htaccess           â”‚
        â”‚                       â”‚      â”‚                        â”‚
        â”‚  âœ… Force HTTPS       â”‚      â”‚  âœ… Force HTTPS        â”‚
        â”‚  âœ… Rewrite to PHP    â”‚      â”‚  âœ… Rewrite to PHP     â”‚
        â”‚  âœ… Preserve params   â”‚      â”‚  âœ… Preserve params    â”‚
        â”‚     [QSA,L] flag      â”‚      â”‚     [QSA,L] flag       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    index.php          â”‚      â”‚    index.php           â”‚
        â”‚  (SAME FILE!)         â”‚      â”‚  (SAME FILE!)          â”‚
        â”‚                       â”‚      â”‚                        â”‚
        â”‚  Detects:             â”‚      â”‚  Detects:              â”‚
        â”‚  $_SERVER['HTTP_HOST']â”‚      â”‚  $_SERVER['HTTP_HOST'] â”‚
        â”‚  = qa.zeventbooks.com â”‚      â”‚  = zeventbooks.com     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Environment: QA      â”‚      â”‚  Environment: PROD     â”‚
        â”‚                       â”‚      â”‚                        â”‚
        â”‚  Sets deployment ID:  â”‚      â”‚  Sets deployment ID:   â”‚
        â”‚  AKfycbzu...QA...     â”‚      â”‚  AKfycb...PROD...      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   cURL Forward        â”‚      â”‚   cURL Forward         â”‚
        â”‚                       â”‚      â”‚                        â”‚
        â”‚  Preserves:           â”‚      â”‚  Preserves:            â”‚
        â”‚  - Query params       â”‚      â”‚  - Query params        â”‚
        â”‚  - POST body          â”‚      â”‚  - POST body           â”‚
        â”‚  - Headers            â”‚      â”‚  - Headers             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚     GOOGLE APPS SCRIPT BACKEND        â”‚
                â”‚                                       â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚  â”‚ QA Deploy   â”‚  â”‚ PROD Deploy  â”‚   â”‚
                â”‚  â”‚             â”‚  â”‚              â”‚   â”‚
                â”‚  â”‚ @HEAD       â”‚  â”‚ @7 (stable)  â”‚   â”‚
                â”‚  â”‚ Auto-update â”‚  â”‚ Manual       â”‚   â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â”‚                                       â”‚
                â”‚  Script URL:                          â”‚
                â”‚  https://script.google.com/macros/s/  â”‚
                â”‚  {DEPLOYMENT_ID}/exec                 â”‚
                â”‚  ?p=admin&tenant=root                 â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚      GOOGLE SHEETS DATABASE           â”‚
                â”‚                                       â”‚
                â”‚  Multi-Tenant Data Store              â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚  â”‚ Events Sheet                   â”‚   â”‚
                â”‚  â”‚ - tenantId: root, abc, cbc...  â”‚   â”‚
                â”‚  â”‚ - eventId, title, date...      â”‚   â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚  â”‚ Analytics Sheet                â”‚   â”‚
                â”‚  â”‚ - Per-tenant tracking          â”‚   â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                â”‚  â”‚ Shortlinks Sheet               â”‚   â”‚
                â”‚  â”‚ - Tenant-isolated tokens       â”‚   â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DEVELOPMENT WORKFLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Developer commits code
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Push to GitHub   â”‚
â”‚  (main branch)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GITHUB ACTIONS - STAGE 1                            â”‚
â”‚                                                                  â”‚
â”‚  1. âœ… ESLint (Code quality)                                    â”‚
â”‚  2. âœ… Jest Unit Tests                                          â”‚
â”‚  3. âœ… Contract Tests                                           â”‚
â”‚  4. ğŸš€ Deploy to Apps Script QA (@HEAD)                        â”‚
â”‚                                                                  â”‚
â”‚  npx clasp push --force                                         â”‚
â”‚  npx clasp deploy -i {DEPLOYMENT_ID_QA}                         â”‚
â”‚                                                                  â”‚
â”‚  Deployment ID: AKfycbzu-U4UgdjdAiXHTg9TD5Y-1gDkc798YSTqQCdhOddGâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… QA ENVIRONMENT AUTOMATICALLY UPDATED                          â”‚
â”‚                                                                   â”‚
â”‚  qa.zeventbooks.com â†’ Apps Script QA Deployment                  â”‚
â”‚                                                                   â”‚
â”‚  Changes are LIVE immediately (no manual intervention)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GITHUB ACTIONS - STAGE 2                            â”‚
â”‚                                                                  â”‚
â”‚  Environment: BASE_URL=https://qa.zeventbooks.com               â”‚
â”‚                                                                  â”‚
â”‚  1. ğŸ” Hostinger health check                                   â”‚
â”‚  2. ğŸ§ª Playwright API tests                                     â”‚
â”‚  3. ğŸ§ª Playwright smoke tests                                   â”‚
â”‚  4. ğŸ“Š Calculate failure rate                                   â”‚
â”‚  5. ğŸ§ª Playwright flow tests (if < 50% failures)                â”‚
â”‚  6. ğŸ§ª Playwright page tests (if < 50% failures)                â”‚
â”‚                                                                  â”‚
â”‚  Tests run against: qa.zeventbooks.com                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ âœ… All tests pass
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MANUAL PROMOTION TO PRODUCTION                                   â”‚
â”‚                                                                   â”‚
â”‚  1. Developer creates production deployment:                     â”‚
â”‚     npx clasp deploy -d "Production v1.1.0"                      â”‚
â”‚                                                                   â”‚
â”‚  2. Copy new deployment ID: AKfycb...PROD_NEW_ID...              â”‚
â”‚                                                                   â”‚
â”‚  3. Update index.php line 44 with new production ID              â”‚
â”‚                                                                   â”‚
â”‚  4. Upload index.php to Hostinger:                               â”‚
â”‚     /public_html/index.php                                       â”‚
â”‚                                                                   â”‚
â”‚  5. Test production:                                             â”‚
â”‚     https://zeventbooks.com?p=status&tenant=root                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… PRODUCTION ENVIRONMENT UPDATED                                â”‚
â”‚                                                                   â”‚
â”‚  zeventbooks.com â†’ Apps Script Production Deployment             â”‚
â”‚                                                                   â”‚
â”‚  Stable, manually controlled updates                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Structure on Hostinger

```
Hostinger Account: zeventbooks.com
â”‚
â”œâ”€â”€ public_html/                              â† PRODUCTION
â”‚   â”‚
â”‚   â”œâ”€â”€ index.php                             â† PHP Proxy (644 permissions)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Detects: zeventbooks.com
â”‚   â”‚   â”œâ”€â”€ Environment: PRODUCTION
â”‚   â”‚   â”œâ”€â”€ Routes to: Apps Script PROD deployment
â”‚   â”‚   â””â”€â”€ Adds headers:
â”‚   â”‚       - X-Zeventbooks-Environment: PRODUCTION
â”‚   â”‚       - X-Zeventbooks-Host: zeventbooks.com
â”‚   â”‚
â”‚   â”œâ”€â”€ .htaccess                             â† Apache config (644 permissions)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Force HTTPS
â”‚   â”‚   â”œâ”€â”€ Route all to index.php [QSA,L]
â”‚   â”‚   â”œâ”€â”€ Security headers
â”‚   â”‚   â””â”€â”€ Performance optimization
â”‚   â”‚
â”‚   â””â”€â”€ proxy-debug.log                       â† (Optional) Debug logs
â”‚
â””â”€â”€ qa.zeventbooks.com/                       â† QA SUBDOMAIN
    â”‚
    â”œâ”€â”€ index.php                             â† SAME FILE AS PRODUCTION
    â”‚   â”‚
    â”‚   â”œâ”€â”€ Detects: qa.zeventbooks.com
    â”‚   â”œâ”€â”€ Environment: QA
    â”‚   â”œâ”€â”€ Routes to: Apps Script QA deployment
    â”‚   â””â”€â”€ Adds headers:
    â”‚       - X-Zeventbooks-Environment: QA
    â”‚       - X-Zeventbooks-Host: qa.zeventbooks.com
    â”‚
    â”œâ”€â”€ .htaccess                             â† SAME FILE AS PRODUCTION
    â”‚
    â””â”€â”€ proxy-debug.log                       â† (Optional) Debug logs
```

---

## Environment Detection Logic

```
User Request: https://qa.zeventbooks.com?p=admin&tenant=root
                                  â”‚
                                  â–¼
                    PHP: $_SERVER['HTTP_HOST']
                                  â”‚
                                  â–¼
                    "qa.zeventbooks.com"
                                  â”‚
                                  â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  if (strpos($host, 'qa.') !== false) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                            Environment: QA
                                  â”‚
                                  â–¼
                  Deployment ID: AKfycbzu...QA...
                                  â”‚
                                  â–¼
              https://script.google.com/macros/s/
              AKfycbzu-U4UgdjdAiXHTg9TD5Y-1gDkc798YSTqQCdhOddG/
              exec?p=admin&tenant=root
```

```
User Request: https://zeventbooks.com?p=admin&tenant=abc
                                  â”‚
                                  â–¼
                    PHP: $_SERVER['HTTP_HOST']
                                  â”‚
                                  â–¼
                      "zeventbooks.com"
                                  â”‚
                                  â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  else (not QA, not localhost)    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        Environment: PRODUCTION
                                  â”‚
                                  â–¼
                  Deployment ID: AKfycb...PROD...
                                  â”‚
                                  â–¼
              https://script.google.com/macros/s/
              AKfycb...PROD_DEPLOYMENT_ID.../
              exec?p=admin&tenant=abc
```

---

## Query Parameter Flow

```
User visits:
https://qa.zeventbooks.com/some/path?p=admin&tenant=root&custom=value
                                         â”‚
                                         â–¼
                            Apache .htaccess processes
                                         â”‚
                                         â–¼
                    RewriteCond %{REQUEST_FILENAME} !-f
                    RewriteCond %{REQUEST_FILENAME} !-d
                    RewriteRule ^(.*)$ index.php [QSA,L]
                                         â”‚
                                         â”‚  [QSA] = Query String Append
                                         â”‚         (preserves all params)
                                         â–¼
                            index.php receives:
                    $_SERVER['QUERY_STRING'] = "p=admin&tenant=root&custom=value"
                                         â”‚
                                         â–¼
                            PHP appends to target URL:
      $targetUrl = GOOGLE_SCRIPT_URL . '?' . $_SERVER['QUERY_STRING']
                                         â”‚
                                         â–¼
                            cURL forwards to:
  https://script.google.com/macros/s/AKfycb.../exec?p=admin&tenant=root&custom=value
                                         â”‚
                                         â–¼
                      Apps Script receives all parameters:
                            p = "admin"
                            tenant = "root"
                            custom = "value"
```

---

## Multi-Tenant Isolation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REQUEST WITH TENANT                           â”‚
â”‚                                                                  â”‚
â”‚  https://zeventbooks.com?p=events&tenant=abc                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              APPS SCRIPT BACKEND PROCESSING                      â”‚
â”‚                                                                  â”‚
â”‚  1. Extract tenant from query parameter                         â”‚
â”‚     const tenantId = e.parameter.tenant; // "abc"               â”‚
â”‚                                                                  â”‚
â”‚  2. Validate tenant ID (whitelist check)                        â”‚
â”‚     const VALID_TENANTS = ['root', 'abc', 'cbc', 'cbl'];        â”‚
â”‚     if (!VALID_TENANTS.includes(tenantId)) {                    â”‚
â”‚       return error('Invalid tenant');                           â”‚
â”‚     }                                                            â”‚
â”‚                                                                  â”‚
â”‚  3. Filter database query by tenant                             â”‚
â”‚     const events = sheet.getDataRange().getValues()             â”‚
â”‚       .filter(row => row[TENANT_COL] === tenantId);             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GOOGLE SHEETS (Multi-Tenant Data)                   â”‚
â”‚                                                                  â”‚
â”‚  Events Sheet:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ tenantId â”‚ eventId         â”‚ title        â”‚ date       â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ root     â”‚ EVT-001         â”‚ Zevent Fest  â”‚ 2025-06-01 â”‚    â”‚
â”‚  â”‚ abc      â”‚ EVT-002         â”‚ Bocce Tourny â”‚ 2025-07-15 â”‚ âœ… â”‚
â”‚  â”‚ cbc      â”‚ EVT-003         â”‚ Club Meeting â”‚ 2025-08-01 â”‚    â”‚
â”‚  â”‚ abc      â”‚ EVT-004         â”‚ Summer Games â”‚ 2025-08-10 â”‚ âœ… â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  Returns only rows where tenantId === "abc"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Response to Client   â”‚
                    â”‚                       â”‚
                    â”‚  Only ABC events:     â”‚
                    â”‚  - EVT-002            â”‚
                    â”‚  - EVT-004            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cost Breakdown

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONTHLY COSTS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Hostinger Domain (zeventbooks.com)                    â”‚
â”‚  Cost: $12/year = $1/month                             â”‚
â”‚                                                         â”‚
â”‚  QA Subdomain (qa.zeventbooks.com)                     â”‚
â”‚  Cost: FREE (included with domain)                     â”‚
â”‚                                                         â”‚
â”‚  SSL Certificates (Let's Encrypt)                      â”‚
â”‚  Cost: FREE                                            â”‚
â”‚                                                         â”‚
â”‚  Google Apps Script                                    â”‚
â”‚  Cost: FREE (within quotas)                            â”‚
â”‚                                                         â”‚
â”‚  Google Sheets Storage                                 â”‚
â”‚  Cost: FREE (Google account)                           â”‚
â”‚                                                         â”‚
â”‚  GitHub Actions                                        â”‚
â”‚  Cost: FREE (public repos)                             â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TOTAL: ~$1/month ($12/year)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Flow

```
Client Request
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTPS Enforcement  â”‚  â† .htaccess forces HTTPS
â”‚  (Port 443)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Security Headers   â”‚  â† X-Frame-Options, X-XSS-Protection
â”‚  (mod_headers)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHP Proxy          â”‚  â† index.php validates & forwards
â”‚                     â”‚
â”‚  âœ… HTTPS only      â”‚
â”‚  âœ… Timeout: 30s    â”‚
â”‚  âœ… SSL verify      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apps Script        â”‚  â† Google's security layer
â”‚  Authorization      â”‚
â”‚                     â”‚
â”‚  âœ… OAuth2          â”‚
â”‚  âœ… Execute as: Me  â”‚
â”‚  âœ… Access: Anyone  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Multi-Tenant       â”‚  â† Tenant isolation in code
â”‚  Data Filter        â”‚
â”‚                     â”‚
â”‚  âœ… Tenant validate â”‚
â”‚  âœ… Admin key check â”‚
â”‚  âœ… Data isolation  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Testing Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STAGE 1: Build & Deploy                     â”‚
â”‚                                                               â”‚
â”‚  âœ… ESLint (Code quality)                   FREE - 2 min     â”‚
â”‚  âœ… Jest Unit Tests                         FREE - 1 min     â”‚
â”‚  âœ… Contract Tests                          FREE - 1 min     â”‚
â”‚  âœ… Deploy to Apps Script                   FREE - 1 min     â”‚
â”‚                                                               â”‚
â”‚  Environment: N/A (mock data)                                â”‚
â”‚  Cost: $0                                                    â”‚
â”‚  Time: ~5 minutes                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STAGE 2: Integration Testing                     â”‚
â”‚                                                               â”‚
â”‚  Environment: BASE_URL=https://qa.zeventbooks.com            â”‚
â”‚                                                               â”‚
â”‚  Critical Tests (always run):                                â”‚
â”‚  âœ… Hostinger health check                  FREE - 30 sec   â”‚
â”‚  âœ… Playwright API tests                    FREE - 3 min    â”‚
â”‚  âœ… Playwright Smoke tests                  FREE - 2 min    â”‚
â”‚                                                               â”‚
â”‚  âš¡ Failure Rate Check                                       â”‚
â”‚                                                               â”‚
â”‚  Expensive Tests (only if < 50% failures):                   â”‚
â”‚  âœ… Playwright Flow tests                   FREE - 4 min    â”‚
â”‚  âœ… Playwright Page tests                   FREE - 5 min    â”‚
â”‚                                                               â”‚
â”‚  Cost: $0 (within GitHub Actions free tier)                 â”‚
â”‚  Time: 5-15 minutes (adaptive)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Setup Checklist

### One-Time Setup
- [ ] Create QA subdomain in Hostinger hPanel
- [ ] Enable SSL for qa.zeventbooks.com
- [ ] Create production Apps Script deployment
- [ ] Update index.php with production deployment ID
- [ ] Add GitHub secrets (DEPLOYMENT_ID_QA, DEPLOYMENT_ID_PROD)

### Every Deployment (Automatic)
- [ ] Push to main branch
- [ ] GitHub Actions runs Stage 1 (build, test, deploy to QA)
- [ ] GitHub Actions runs Stage 2 (tests against qa.zeventbooks.com)
- [ ] QA environment automatically updated

### Production Promotion (Manual)
- [ ] Create new production deployment: `npx clasp deploy -d "v1.1.0"`
- [ ] Update index.php with new production deployment ID
- [ ] Upload index.php to /public_html/
- [ ] Test production: `curl https://zeventbooks.com?p=status&tenant=root`

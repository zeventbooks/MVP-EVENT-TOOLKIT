# ============================================
# Staging Worker Configuration (Root wrangler.toml)
# ============================================
# This is the staging deployment configuration.
# For production, use cloudflare-proxy/wrangler.toml [env.production]
#
# Deployment: wrangler deploy
# This deploys to stg.eventangle.com for pre-production validation.
#
# Naming Convention (see config/deployment-ids.js):
#   STAGING_* - Staging environment variables
#   PROD_*    - Production environment variables
# ============================================

name = "eventangle-staging"
main = "cloudflare-proxy/worker.js"
compatibility_date = "2024-01-01"

# ===========================================
# Text Rules for Embedded Templates
# ===========================================
# Import HTML templates as text strings for embedding in the Worker.
# This eliminates the need for KV storage for templates.
[[rules]]
type = "Text"
globs = ["**/*.html"]
fallthrough = true

routes = [
  { pattern = "stg.eventangle.com/*", zone_name = "eventangle.com" },
  { pattern = "api-stg.eventangle.com/*", zone_name = "eventangle.com" }
]

[vars]
# ============================================
# STAGING DEPLOYMENT CONFIGURATION
# ============================================
# Uses standardized naming convention:
#   STAGING_DEPLOYMENT_ID  - Web app deployment ID (changes per deploy)
#   STAGING_WEB_APP_URL    - Executable URL (runtime)
#
# Script ID: 1gHiPuj7eXNk09dDyk17SJ6QsCJg7LMqXBRrkowljL3z2TaAKFIvBLhHJ
# ============================================
WORKER_ENV = "staging"
# Story 2: Worker versioning - build version logged in X-Worker-Build-Version header
WORKER_BUILD_VERSION = "stg-2025.12.09"
UPSTREAM_TIMEOUT_MS = "30000"
# ============================================
# Story 2: Primary env vars (use these)
# ============================================
# STAGING_WEB_APP_URL is the SINGLE SOURCE OF TRUTH for staging
# The Worker uses this URL directly to call GAS backend
STAGING_DEPLOYMENT_ID = "AKfycbwFneYCpkio7wCn7y08eDUb2PRCPc2Tdtbv20L4AbEHvuCvoqY9ks7-ONL0pzPPw4Hm"
STAGING_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwFneYCpkio7wCn7y08eDUb2PRCPc2Tdtbv20L4AbEHvuCvoqY9ks7-ONL0pzPPw4Hm/exec"
# ============================================
# DEPRECATED: Legacy aliases (do not use for new code)
# ============================================
# These are kept ONLY for backward compatibility with older code paths
# Will be removed in a future release - migrate to STAGING_* vars
DEPLOYMENT_ID = "AKfycbwFneYCpkio7wCn7y08eDUb2PRCPc2Tdtbv20L4AbEHvuCvoqY9ks7-ONL0pzPPw4Hm"
GAS_DEPLOYMENT_BASE_URL = "https://script.google.com/macros/s/AKfycbwFneYCpkio7wCn7y08eDUb2PRCPc2Tdtbv20L4AbEHvuCvoqY9ks7-ONL0pzPPw4Hm/exec"

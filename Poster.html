<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title><?= appTitle ?> Â· Poster</title>
  <?!= include('Header'); ?>
  <?!= include('NUSDK'); ?>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
</head>
<body>
  <main id="app" class="container">
    <section class="card">
      <h2>Poster</h2>
      <div id="qr" class="qr-grid"></div>
    </section>
  </main>
  <script>
  const TENANT='<?= tenantId ?>', SCOPE='events';
  const ID = new URL(location.href).searchParams.get('id');
  NU.swr('api_get', { tenantId:TENANT, scope:SCOPE, id:ID }, {
    staleMs: 120000,
    onUpdate: (evt) => {
      const el=document.getElementById('qr'); el.innerHTML='';
      // Fixed: Use publicUrl for QR code so users can scan to view the event
      const url = evt?.links?.publicUrl;
      if (!url){ el.innerHTML = `<div class="qr-code"><p>QR unavailable (not verified)</p></div>`; return; }
      const box=document.createElement('div'); box.className='qr-code';
      box.innerHTML = `
        <h3>${NU.esc(evt?.data?.name||'Event')}</h3>
        <img alt="QR" src="https://quickchart.io/qr?text=${encodeURIComponent(url)}&size=256">
        <p>${NU.esc(url)}</p>`;
      el.appendChild(box);
    }
  });
  </script>
</body>
</html>

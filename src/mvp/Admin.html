<!--
================================================================================
MVP SURFACE - Focus Group Critical
================================================================================
Page: Admin.html
Purpose: Event management dashboard for organizers
Status: HARDENED for MVP v1.0

SEVEN-CARD ADMIN SHELL (Flow-First Layout):
  Card 1 - Event Basics: Name, date, venue, type/template (what you just created)
  Card 2 - Sponsors: Generate sponsor analytics links (they're paying!)
  Card 3 - Sign-Up Form: Form URL, QR, count (get people registered)
  Card 4 - Poster Page: Link + QR + preview (print for flyers & windows)
  Card 5 - TV Display: Link + tips (put it on your bar screens)
  Card 6 - Public Page: Link + QR + preview (share with customers)
  Card 7 - Shared Report: View report link (post-event analytics)

  Advanced Tools: Event ID, diagnostics (collapsed by default)

  Copy written for bar owners, not developers.

SCHEMA CONTRACT: /schemas/event.schema.json

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
READS FROM EVENT SCHEMA (for display after event creation):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  - event.id                ‚Üí Event ID display
  - event.slug              ‚Üí Slug display
  - event.name              ‚Üí Event info card
  - event.startDateISO      ‚Üí Date display + phase calculation
  - event.venue             ‚Üí Location display
  - event.links.publicUrl   ‚Üí Link card + copy button
  - event.links.displayUrl  ‚Üí Link card + copy button
  - event.links.posterUrl   ‚Üí Link card + copy button
  - event.links.signupUrl   ‚Üí Link card + copy button
  - event.qr.public         ‚Üí QR code preview
  - event.qr.signup         ‚Üí QR code preview
  - event.ctas.primary.label ‚Üí CTA display
  - event.settings.*        ‚Üí Enabled sections summary
  - event.createdAtISO      ‚Üí Edit mode preservation
  - event.sponsors[]        ‚Üí Sponsor Performance Links section
  - event.sponsors[].placement ‚Üí Sponsor placement badges (Public/Display/Poster/TV Banner)
  - event.links.*           ‚Üí Preview links (Public/Display/Poster/Report)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
WRITES TO EVENT SCHEMA (via buildEventFromForm()):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  IDENTITY (MVP Required):
    - event.name             ‚Üê #name input
    - event.startDateISO     ‚Üê #startDateISO input
    - event.venue            ‚Üê #venue input

  CTAs (MVP Required):
    - event.ctas.primary.label ‚Üê #ctaLabel input

  SETTINGS (MVP Required - must match /schemas/event.schema.json Settings):
    Section Visibility (MVP Required):
    - event.settings.showSchedule     ‚Üê #showSchedule checkbox
    - event.settings.showStandings    ‚Üê #showStandings checkbox
    - event.settings.showBracket      ‚Üê #showBracket checkbox

    Content Section Visibility (Template-Aware - Feature 4):
    - event.settings.showVideo        ‚Üê #showVideo checkbox (template default)
    - event.settings.showMap          ‚Üê #showMap checkbox (template default)
    - event.settings.showGallery      ‚Üê #showGallery checkbox (template default)

    Master Toggle (MVP Optional):
    - event.settings.showSponsors     ‚Üê #showSponsors checkbox (template default)

    Surface-Specific (MVP Optional, default: true):
    - event.settings.showSponsorBanner ‚Üê #showSponsorBanner checkbox
    - event.settings.showSponsorStrip  ‚Üê #showSponsorStrip checkbox
    - event.settings.showLeagueStrip   ‚Üê #showLeagueStrip checkbox
    - event.settings.showQRSection     ‚Üê #showQRSection checkbox

  EXTERNAL DATA (V2 Optional - League panel):
    - event.externalData.scheduleUrl  ‚Üê #scheduleUrl input
    - event.externalData.standingsUrl ‚Üê #standingsUrl input
    - event.externalData.bracketUrl   ‚Üê #bracketUrl input

  SERVER-GENERATED (read-only, preserved in edit mode):
    - event.id              ‚Üí STATE.id (preserved)
    - event.slug            ‚Üí STATE.slug (preserved)
    - event.createdAtISO    ‚Üí STATE.createdAtISO (preserved)
    - event.links.*         ‚Üí Server fills on create
    - event.qr.*            ‚Üí Server generates on create

V2 HIDDEN SECTIONS (not in schema):
    - Legacy Sections panel (video, map, notes, gallery)
    - Summary, Media, Bio panels
    - Additional Links panel
    - Broadcast links (statsUrl, scoreboardUrl, streamUrl)
    - Provider integration
    - Sponsors configuration

DO NOT add fields without updating:
  - /schemas/event.schema.json (source of truth)
  - src/mvp/Code.gs (_buildEventContract_)

Related MVP Surfaces: Poster, Display, Public, Sponsor, SharedReport
================================================================================
-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title><?= appTitle ?> ¬∑ Admin</title>
  <?!= include('Styles'); ?>
  <?!= include('DesignAdapter'); ?>
  <?!= include('NUSDK'); ?>
  <?!= include('SharedUtils'); ?>
  <?!= include('CollapsibleSections'); ?>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="referrer" content="no-referrer"/>
  <style>
    /* MVP Template Picker - matches .event-card pattern */
    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
    }
    .template-card {
      padding: 16px 12px;
      background: var(--color-gray-50, #f8fafc);
      border: 1px solid var(--color-gray-200, #e2e8f0);
      border-left: 3px solid var(--color-gray-400, #94a3b8);
      border-radius: var(--radius-md, 12px);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-base, 0.2s ease);
    }
    .template-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md, 0 4px 12px rgba(0,0,0,0.1));
      border-left-color: var(--color-primary, #2563eb);
      background: #fff;
    }
    .template-card.selected {
      border-left-color: var(--color-primary, #2563eb);
      border-color: var(--color-primary-light, #bfdbfe);
      background: var(--color-primary-bg, #eff6ff);
      box-shadow: 0 0 0 3px var(--focus-ring-color-alpha, rgba(37, 99, 235, 0.15));
    }
    .template-card .template-icon {
      font-size: 2rem;
      margin-bottom: 8px;
    }
    .template-card .template-name {
      font-weight: var(--font-weight-semibold, 600);
      font-size: 0.9rem;
      color: var(--color-gray-800, #1e293b);
      margin-bottom: 4px;
    }
    .template-card .template-desc {
      font-size: 0.75rem;
      color: var(--color-gray-500, #64748b);
      line-height: 1.3;
    }
    .template-card .template-sections {
      display: flex;
      justify-content: center;
      gap: 4px;
      margin-top: 8px;
      font-size: var(--font-size-xs, 0.75rem); /* D-AUDIT: Aligned to type scale from 0.7rem */
      opacity: 0.7;
    }
    .template-card .template-sections span {
      padding: 2px 4px;
      background: var(--color-gray-200, #e2e8f0);
      border-radius: var(--radius-sm, 4px);
    }
    .template-card .template-sections span.off {
      opacity: 0.4;
      text-decoration: line-through;
    }
    .template-card .recommended-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--color-primary, #2563eb);
      color: white;
      font-size: var(--font-size-xs, 0.75rem); /* D-AUDIT: Aligned to type scale from 0.6rem (min readable) */
      padding: 2px 6px;
      border-radius: var(--radius-base, 8px);
      font-weight: var(--font-weight-semibold, 600);
    }
    .template-card {
      position: relative;
    }
    .template-loading {
      grid-column: 1 / -1;
      text-align: center;
      padding: var(--space-6, 24px);
      color: var(--color-gray-500, #64748b);
    }

    /* Template Groups (Stage-Gate UI) */
    .template-group {
      margin-bottom: 20px;
    }
    .template-group-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--color-gray-200, #e2e8f0);
    }
    .template-group-icon {
      font-size: 1.25rem;
    }
    .template-group-label {
      font-weight: var(--font-weight-semibold, 600);
      font-size: 0.95rem;
      color: var(--color-gray-700, #334155);
    }
    .template-group-desc {
      font-size: 0.8rem;
      color: var(--color-gray-500, #64748b);
      margin-left: auto;
    }
    .template-group-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
    }

    /* ===== Mobile-First Admin Enhancements ===== */

    /* Mobile card padding adjustments */
    @media (max-width: 640px) {
      .container {
        padding: 12px;
      }

      .card {
        padding: 16px;
        margin-bottom: 16px;
      }

      /* Seven-Card Shell mobile adjustments */
      #eventCard .card {
        padding: 16px 14px;
      }

      /* Card headers: stack icon and text on narrow screens */
      #eventCard .card > div:first-child {
        flex-wrap: wrap;
      }

      /* Smaller icons on mobile */
      #eventCard .card > div > div:first-child {
        font-size: 1.8rem;
      }

      /* Card titles */
      #eventCard h3 {
        font-size: 1.1rem;
      }

      /* Link fields with proper truncation */
      #eventCard a[id^="lnk"] {
        font-size: 0.75rem;
        line-height: 1.4;
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
      }

      /* Full-width buttons on mobile */
      #eventCard .card button {
        flex: 1 1 calc(50% - 4px);
        min-width: 0;
        padding: 12px 10px;
        font-size: 0.85rem;
      }

      /* Stack buttons vertically when 3+ buttons */
      #eventCard .card div[style*="display: flex"][style*="gap: 8px"] {
        flex-wrap: wrap;
      }

      /* Template picker mobile - 2 columns */
      .template-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .template-card {
        padding: 12px 8px;
      }

      .template-card .template-icon {
        font-size: 1.5rem;
      }

      .template-card .template-name {
        font-size: 0.8rem;
      }

      .template-card .template-desc {
        font-size: 0.7rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .template-card .template-sections {
        display: none; /* Hide section icons on mobile */
      }

      /* Form inputs - prevent zoom on iOS */
      input, select, textarea {
        font-size: 16px !important;
      }

      /* Checkbox groups mobile */
      .checkbox-group {
        gap: 6px;
      }

      .checkbox-label {
        padding: 10px;
        font-size: 0.85rem;
        flex: 1 1 calc(50% - 3px);
        min-width: 0;
        justify-content: center;
      }

      /* QR preview sizing */
      #qrPosterPreview img,
      #qrPublicPreview img {
        max-width: 60px;
        max-height: 60px;
      }

      /* Sponsor card input */
      #customSponsorId {
        min-width: 100% !important;
        margin-bottom: 8px;
      }

      #sponsorPerformanceCard > div[style*="display: flex"] {
        flex-direction: column;
      }

      #sponsorPerformanceCard button {
        width: 100%;
      }

      /* Sponsor table mobile layout - stack columns */
      .sponsor-report-table {
        display: block;
      }
      .sponsor-report-table thead {
        display: none;
      }
      .sponsor-report-table tbody {
        display: block;
      }
      .sponsor-report-table tr {
        display: flex;
        flex-direction: column;
        padding: 12px 0;
        gap: 8px;
      }
      .sponsor-report-table td {
        display: block;
        padding: 4px 0 !important;
        text-align: left !important;
      }
      .sponsor-report-table td:nth-child(2)::before {
        content: 'Visible on: ';
        font-size: 0.7rem;
        color: #64748b;
      }
      .sponsor-report-table td:nth-child(3),
      .sponsor-report-table td:nth-child(4) {
        display: inline-block;
        width: auto;
      }

      /* Collapsible headers - better tap target */
      .collapsible-header {
        padding: 16px;
        min-height: 52px;
      }

      /* Advanced details summary */
      details summary {
        padding: 12px 0;
        font-size: 0.9rem;
      }

      /* Make button group full-width */
      .button-group {
        flex-direction: column;
      }

      .button-group button {
        width: 100%;
        margin: 0;
      }

      .button-group .btn-primary,
      .button-group .btn-secondary {
        padding: 14px 16px;
      }
    }

    /* Very small screens (iPhone SE, etc.) */
    @media (max-width: 375px) {
      .container {
        padding: 8px;
      }

      #eventCard .card {
        padding: 14px 12px;
      }

      .template-grid {
        grid-template-columns: 1fr; /* Single column */
      }

      .checkbox-label {
        flex: 1 1 100%;
      }
    }
    /* Section toggles grid */
    .sections-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 10px;
    }
    .section-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      background: var(--color-gray-50, #f8fafc);
      border: 1px solid var(--color-gray-200, #e2e8f0);
      border-radius: var(--radius-base, 8px);
      cursor: pointer;
      transition: all var(--transition-fast, 0.15s ease);
    }
    .section-toggle:hover {
      background: var(--color-gray-100, #f1f5f9);
    }
    .section-toggle input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--color-primary, #2563eb);
    }
    .section-toggle .section-label {
      font-size: var(--font-size-sm, 0.875rem);
      color: var(--color-gray-600, #475569);
    }
    .section-toggle:has(input:checked) {
      background: var(--color-primary-bg, #eff6ff);
      border-color: var(--color-primary-light, #bfdbfe);
    }
    .section-toggle:has(input:checked) .section-label {
      color: var(--color-primary-dark, #1e40af);
      font-weight: var(--font-weight-medium, 500);
    }
    /* Modified from template indicator */
    .sections-modified-notice {
      display: none;
      margin-top: 12px;
      padding: 8px 12px;
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: 8px;
      font-size: var(--font-size-sm, 0.875rem); /* D-AUDIT: Aligned to type scale from 0.8rem */
      color: #92400e;
    }
    .sections-modified-notice.visible {
      display: block;
    }

    /* ===== Happy Path Checklist ===== */
    /* Visible checklist for first-time bar owners */
    .happy-path-checklist {
      background: linear-gradient(135deg, var(--color-gray-50, #f8fafc) 0%, #fff 100%);
      border: 1px solid var(--color-gray-200, #e2e8f0);
      border-radius: var(--radius-lg, 16px);
      padding: 16px 20px;
      margin-bottom: 20px;
    }

    .happy-path-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--color-gray-200, #e2e8f0);
    }

    .happy-path-header h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-gray-700, #334155);
    }

    .happy-path-header .progress-text {
      margin-left: auto;
      font-size: 0.8rem;
      color: var(--color-gray-500, #64748b);
    }

    .checklist-items {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .checklist-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: white;
      border: 1px solid var(--color-gray-200, #e2e8f0);
      border-radius: var(--radius-base, 8px);
      font-size: 0.85rem;
      color: var(--color-gray-600, #475569);
      cursor: pointer;
      transition: all var(--transition-fast, 0.15s ease);
      flex: 0 0 auto;
    }

    .checklist-item:hover {
      background: var(--color-gray-50, #f8fafc);
      border-color: var(--color-gray-300, #cbd5e1);
      transform: translateY(-1px);
    }

    .checklist-item:active {
      transform: translateY(0);
    }

    .checklist-item .check-indicator {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      flex-shrink: 0;
      transition: all var(--transition-fast, 0.15s ease);
    }

    .checklist-item .check-indicator.pending {
      background: var(--color-gray-100, #f1f5f9);
      border: 2px solid var(--color-gray-300, #cbd5e1);
      color: transparent;
    }

    .checklist-item .check-indicator.done {
      background: #10b981;
      border: 2px solid #10b981;
      color: white;
    }

    .checklist-item .check-indicator.optional {
      background: var(--color-gray-100, #f1f5f9);
      border: 2px dashed var(--color-gray-300, #cbd5e1);
      color: var(--color-gray-400, #94a3b8);
      font-size: 0.65rem;
    }

    .checklist-item.done {
      background: #f0fdf4;
      border-color: #86efac;
    }

    .checklist-item.done .item-label {
      color: #166534;
    }

    .checklist-item.optional-pending {
      border-style: dashed;
    }

    .checklist-item .item-label {
      white-space: nowrap;
    }

    .checklist-item .item-label .optional-tag {
      font-size: 0.7rem;
      color: var(--color-gray-400, #94a3b8);
      font-weight: normal;
    }

    .checklist-item .item-label .time-estimate {
      font-size: 0.7rem;
      color: var(--color-primary, #2563eb);
      background: var(--color-primary-bg, #eff6ff);
      padding: 2px 6px;
      border-radius: 8px;
      font-weight: 500;
      margin-left: 6px;
    }

    .checklist-item.done .item-label .time-estimate {
      background: #dcfce7;
      color: #166534;
    }

    .checklist-item .goto-arrow {
      margin-left: 4px;
      color: var(--color-gray-400, #94a3b8);
      font-size: 0.75rem;
    }

    /* Mobile: Stack checklist items vertically */
    @media (max-width: 640px) {
      .happy-path-checklist {
        padding: 14px 16px;
        margin-bottom: 16px;
      }

      .happy-path-header {
        flex-wrap: wrap;
      }

      .happy-path-header .progress-text {
        width: 100%;
        margin-left: 28px;
        margin-top: 4px;
      }

      .checklist-items {
        flex-direction: column;
        gap: 6px;
      }

      .checklist-item {
        width: 100%;
        padding: 12px 14px;
        justify-content: flex-start;
      }

      .checklist-item .goto-arrow {
        margin-left: auto;
      }
    }

    /* Very small screens */
    @media (max-width: 375px) {
      .happy-path-checklist {
        padding: 12px;
      }

      .checklist-item {
        padding: 10px 12px;
        font-size: 0.8rem;
      }
    }

    /* ===== Mobile Collapsible Cards ===== */
    /* Cards that can collapse on mobile for better UX */
    .card-mobile-collapsible {
      position: relative;
    }

    .card-mobile-collapsible .card-collapse-toggle {
      display: none; /* Hidden on desktop */
    }

    .card-mobile-collapsible .card-collapsible-body {
      overflow: hidden;
      transition: max-height 0.3s ease, opacity 0.2s ease;
      max-height: 2000px;
      opacity: 1;
    }

    .card-mobile-collapsible.mobile-collapsed .card-collapsible-body {
      max-height: 0;
      opacity: 0;
      padding-top: 0 !important;
      margin-top: 0 !important;
    }

    @media (max-width: 640px) {
      /* Show collapse toggle on mobile */
      .card-mobile-collapsible .card-collapse-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        padding: 4px 0;
        margin-top: -8px;
        min-height: 44px; /* iOS tap target */
      }

      .card-mobile-collapsible .card-collapse-toggle .collapse-hint {
        font-size: 0.75rem;
        color: var(--color-gray-400, #94a3b8);
        margin-right: 4px;
      }

      .card-mobile-collapsible .card-collapse-toggle .collapse-icon {
        font-size: 1.2rem;
        color: var(--color-gray-400, #94a3b8);
        transition: transform 0.3s ease;
      }

      .card-mobile-collapsible.mobile-collapsed .card-collapse-toggle .collapse-icon {
        transform: rotate(-90deg);
      }

      /* Collapsed card header styling */
      .card-mobile-collapsible.mobile-collapsed {
        padding-bottom: 12px !important;
      }

      /* Primary actions quick-access row on mobile */
      .mobile-primary-actions {
        display: flex;
        gap: 8px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--color-gray-200, #e2e8f0);
        flex-wrap: wrap;
      }

      .mobile-primary-actions .btn-primary,
      .mobile-primary-actions .btn-secondary {
        flex: 1;
        min-width: 0;
        padding: 12px 8px;
        font-size: 0.8rem;
        text-align: center;
      }

      /* Hide mobile actions row on desktop */
      .mobile-primary-actions {
        display: flex;
      }
    }

    @media (min-width: 641px) {
      .mobile-primary-actions {
        display: none !important;
      }
    }

    /* ===== Quick Start Guide - "10 Minutes to Launch" ===== */
    .quick-start-guide {
      background: linear-gradient(135deg, #eff6ff 0%, #f0fdf4 100%);
      border: 1px solid #bfdbfe;
      border-left: 4px solid #2563eb;
      margin-bottom: 24px;
    }

    .quick-start-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(37, 99, 235, 0.15);
    }

    .quick-start-icon {
      font-size: 2.5rem;
      line-height: 1;
    }

    .quick-start-title h2 {
      margin: 0 0 4px 0;
      font-size: 1.25rem;
      color: var(--color-gray-800, #1e293b);
    }

    .quick-start-title .muted {
      margin: 0;
      font-size: 0.9rem;
    }

    .quick-start-steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
    }

    .quick-start-step {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 14px;
      background: white;
      border: 1px solid var(--color-gray-200, #e2e8f0);
      border-radius: var(--radius-base, 8px);
      transition: all var(--transition-fast, 0.15s ease);
    }

    .quick-start-step:hover {
      border-color: var(--color-primary-light, #bfdbfe);
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.08);
    }

    .quick-start-step.optional {
      border-style: dashed;
      background: var(--color-gray-50, #f8fafc);
    }

    .quick-start-step .step-number {
      width: 28px;
      height: 28px;
      background: var(--color-primary, #2563eb);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.85rem;
      flex-shrink: 0;
    }

    .quick-start-step.optional .step-number {
      background: var(--color-gray-300, #cbd5e1);
      color: var(--color-gray-600, #475569);
    }

    .quick-start-step .step-content {
      flex: 1;
      min-width: 0;
    }

    .quick-start-step .step-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .quick-start-step .step-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--color-gray-800, #1e293b);
    }

    .quick-start-step .step-time {
      font-size: 0.75rem;
      color: var(--color-primary, #2563eb);
      background: var(--color-primary-bg, #eff6ff);
      padding: 2px 8px;
      border-radius: 12px;
      font-weight: 500;
      white-space: nowrap;
    }

    .quick-start-step.optional .step-time {
      background: var(--color-gray-100, #f1f5f9);
      color: var(--color-gray-500, #64748b);
    }

    .quick-start-step .step-desc {
      margin: 0;
      font-size: 0.8rem;
      color: var(--color-gray-500, #64748b);
      line-height: 1.4;
    }

    .quick-start-footer {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(37, 99, 235, 0.1);
      text-align: center;
    }

    .quick-start-footer .muted {
      margin: 0;
      font-size: 0.85rem;
    }

    /* Mobile: Stack steps vertically */
    @media (max-width: 640px) {
      .quick-start-guide {
        padding: 16px;
        margin-bottom: 16px;
      }

      .quick-start-header {
        flex-wrap: wrap;
        gap: 12px;
      }

      .quick-start-icon {
        font-size: 2rem;
      }

      .quick-start-title h2 {
        font-size: 1.1rem;
      }

      .quick-start-steps {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .quick-start-step {
        padding: 10px 12px;
      }

      .quick-start-step .step-number {
        width: 24px;
        height: 24px;
        font-size: 0.8rem;
      }

      .quick-start-step .step-title {
        font-size: 0.85rem;
      }

      .quick-start-step .step-desc {
        font-size: 0.75rem;
      }
    }

    /* Very small screens */
    @media (max-width: 375px) {
      .quick-start-guide {
        padding: 12px;
      }

      .quick-start-step .step-header {
        flex-wrap: wrap;
      }

      .quick-start-step .step-time {
        margin-top: 4px;
      }
    }

    /* ===== Create & Launch Wizard - S08 Guided Flow ===== */
    .launch-wizard {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f0fdf4 100%);
      border: 2px solid #0ea5e9;
      border-radius: var(--radius-lg, 16px);
      margin-bottom: 24px;
      overflow: hidden;
    }

    .wizard-header {
      background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
      padding: 20px 24px;
      color: white;
    }

    .wizard-header h2 {
      margin: 0 0 4px 0;
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .wizard-header .wizard-subtitle {
      margin: 0;
      opacity: 0.9;
      font-size: 0.95rem;
    }

    /* Step Progress Indicator */
    .wizard-progress {
      display: flex;
      justify-content: space-between;
      padding: 16px 24px;
      background: white;
      border-bottom: 1px solid var(--color-gray-200, #e2e8f0);
      gap: 8px;
      overflow-x: auto;
    }

    .wizard-progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      min-width: 60px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .wizard-progress-step:hover:not(.disabled) {
      transform: translateY(-2px);
    }

    .wizard-progress-step.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .wizard-progress-step::after {
      content: '';
      position: absolute;
      top: 14px;
      left: 60%;
      width: calc(100% - 20px);
      height: 2px;
      background: var(--color-gray-200, #e2e8f0);
    }

    .wizard-progress-step:last-child::after {
      display: none;
    }

    .wizard-progress-step.completed::after {
      background: #10b981;
    }

    .wizard-progress-step .step-dot {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--color-gray-200, #e2e8f0);
      color: var(--color-gray-500, #64748b);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.85rem;
      position: relative;
      z-index: 1;
      transition: all 0.3s ease;
    }

    .wizard-progress-step.active .step-dot {
      background: #2563eb;
      color: white;
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
    }

    .wizard-progress-step.completed .step-dot {
      background: #10b981;
      color: white;
    }

    .wizard-progress-step .step-label {
      font-size: 0.7rem;
      color: var(--color-gray-500, #64748b);
      margin-top: 6px;
      text-align: center;
      white-space: nowrap;
    }

    .wizard-progress-step.active .step-label {
      color: #2563eb;
      font-weight: 600;
    }

    .wizard-progress-step.completed .step-label {
      color: #10b981;
    }

    /* Wizard Content Area */
    .wizard-content {
      padding: 24px;
      background: white;
    }

    .wizard-step {
      display: none;
      animation: wizardFadeIn 0.3s ease;
    }

    .wizard-step.active {
      display: block;
    }

    @keyframes wizardFadeIn {
      from { opacity: 0; transform: translateX(10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .wizard-step-header {
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--color-gray-100, #f1f5f9);
    }

    .wizard-step-header h3 {
      margin: 0 0 4px 0;
      font-size: 1.2rem;
      color: var(--color-gray-800, #1e293b);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .wizard-step-header .step-description {
      margin: 0;
      color: var(--color-gray-500, #64748b);
      font-size: 0.9rem;
    }

    /* Wizard Template Grid - Larger for visibility */
    .wizard-template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .wizard-template-card {
      padding: 20px 16px;
      background: var(--color-gray-50, #f8fafc);
      border: 2px solid var(--color-gray-200, #e2e8f0);
      border-radius: var(--radius-md, 12px);
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .wizard-template-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      border-color: var(--color-primary-light, #bfdbfe);
    }

    .wizard-template-card.selected {
      border-color: #2563eb;
      background: #eff6ff;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
    }

    .wizard-template-card .template-icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .wizard-template-card .template-name {
      font-weight: 600;
      font-size: 1rem;
      color: var(--color-gray-800, #1e293b);
      margin-bottom: 4px;
    }

    .wizard-template-card .template-desc {
      font-size: 0.8rem;
      color: var(--color-gray-500, #64748b);
      line-height: 1.3;
    }

    /* Wizard Sign-Up Options */
    .wizard-signup-options {
      display: grid;
      gap: 12px;
      margin-top: 16px;
    }

    .wizard-signup-option {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: var(--color-gray-50, #f8fafc);
      border: 1px solid var(--color-gray-200, #e2e8f0);
      border-radius: var(--radius-md, 12px);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .wizard-signup-option:hover {
      background: white;
      border-color: var(--color-primary-light, #bfdbfe);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .wizard-signup-option.selected {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .wizard-signup-option .option-icon {
      font-size: 1.8rem;
      flex-shrink: 0;
    }

    .wizard-signup-option .option-content {
      flex: 1;
    }

    .wizard-signup-option .option-title {
      font-weight: 600;
      color: var(--color-gray-800, #1e293b);
      margin-bottom: 2px;
    }

    .wizard-signup-option .option-desc {
      font-size: 0.85rem;
      color: var(--color-gray-500, #64748b);
    }

    /* Wizard Links Preview */
    .wizard-links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .wizard-link-card {
      background: white;
      border: 1px solid var(--color-gray-200, #e2e8f0);
      border-radius: var(--radius-md, 12px);
      padding: 16px;
      text-align: center;
    }

    .wizard-link-card .link-icon {
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .wizard-link-card .link-title {
      font-weight: 600;
      color: var(--color-gray-800, #1e293b);
      margin-bottom: 4px;
    }

    .wizard-link-card .link-desc {
      font-size: 0.8rem;
      color: var(--color-gray-500, #64748b);
      margin-bottom: 12px;
    }

    .wizard-link-card .link-actions {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .wizard-link-card .link-actions .btn-sm {
      padding: 6px 12px;
      font-size: 0.8rem;
    }

    .wizard-qr-preview {
      background: white;
      padding: 8px;
      border-radius: 8px;
      display: inline-block;
      margin-bottom: 8px;
      border: 1px solid var(--color-gray-100, #f1f5f9);
    }

    /* Wizard Navigation */
    .wizard-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      background: var(--color-gray-50, #f8fafc);
      border-top: 1px solid var(--color-gray-200, #e2e8f0);
    }

    .wizard-nav .nav-left,
    .wizard-nav .nav-right {
      display: flex;
      gap: 12px;
    }

    .wizard-nav .btn-wizard-back {
      background: white;
      border: 1px solid var(--color-gray-300, #cbd5e1);
      color: var(--color-gray-600, #475569);
      padding: 10px 20px;
      border-radius: var(--radius-base, 8px);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .wizard-nav .btn-wizard-back:hover {
      background: var(--color-gray-100, #f1f5f9);
      border-color: var(--color-gray-400, #94a3b8);
    }

    .wizard-nav .btn-wizard-skip {
      background: transparent;
      border: none;
      color: var(--color-gray-500, #64748b);
      padding: 10px 16px;
      cursor: pointer;
      font-size: 0.9rem;
      text-decoration: underline;
    }

    .wizard-nav .btn-wizard-skip:hover {
      color: var(--color-gray-700, #334155);
    }

    .wizard-nav .btn-wizard-next {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      border: none;
      color: white;
      padding: 10px 24px;
      border-radius: var(--radius-base, 8px);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .wizard-nav .btn-wizard-next:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .wizard-nav .btn-wizard-next:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .wizard-nav .btn-wizard-launch {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .wizard-nav .btn-wizard-launch:hover {
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    /* Wizard Success State */
    .wizard-success {
      text-align: center;
      padding: 32px 24px;
    }

    .wizard-success .success-icon {
      font-size: 4rem;
      margin-bottom: 16px;
    }

    .wizard-success h3 {
      margin: 0 0 8px 0;
      font-size: 1.5rem;
      color: #10b981;
    }

    .wizard-success p {
      margin: 0 0 24px 0;
      color: var(--color-gray-600, #475569);
    }

    /* Wizard Mobile Responsive */
    @media (max-width: 640px) {
      .launch-wizard {
        margin: 0 -16px 16px -16px;
        border-radius: 0;
        border-left: none;
        border-right: none;
      }

      .wizard-header {
        padding: 16px;
      }

      .wizard-header h2 {
        font-size: 1.2rem;
      }

      .wizard-progress {
        padding: 12px 16px;
      }

      .wizard-progress-step .step-label {
        font-size: 0.65rem;
      }

      .wizard-content {
        padding: 16px;
      }

      .wizard-template-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .wizard-template-card {
        padding: 14px 10px;
      }

      .wizard-template-card .template-icon {
        font-size: 2rem;
      }

      .wizard-links-grid {
        grid-template-columns: 1fr;
      }

      .wizard-nav {
        flex-wrap: wrap;
        gap: 12px;
        padding: 12px 16px;
      }

      .wizard-nav .nav-left,
      .wizard-nav .nav-right {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <?!= include('Header'); ?>
  <?!= include('HeaderInit'); ?>

  <main id="app" class="container">

    <!-- Event Lifecycle Dashboard - DEPRECATED: Content moved to Diagnostics accordion in Five-Card layout -->
    <!-- Kept hidden for backward compatibility with any code referencing these IDs -->
    <div id="dashboardCard" style="display:none !important;">
      <div id="eventPhaseIndicator"></div>
      <div id="statViews">-</div>
      <div id="statImpressions">-</div>
      <div id="statCTR">-</div>
      <div id="statEngagement">-</div>
      <div id="preEventProgress"></div>
      <div id="eventDayProgress"></div>
      <div id="postEventProgress"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- S08: CREATE & LAUNCH WIZARD - Guided "10-Minute Event" Flow             -->
    <!-- Walks bar owners through: Create ‚Üí Template ‚Üí Sign-ups ‚Üí Links ‚Üí Launch -->
    <!-- Uses existing RPCs: api_saveEvent, api_getEventTemplates                -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section class="launch-wizard" id="launchWizard" data-testid="launch-wizard">
      <div class="wizard-header">
        <h2>
          <span>üöÄ</span>
          Create & Launch Your Event
        </h2>
        <p class="wizard-subtitle">Ready in 10 minutes‚Äîwe'll walk you through every step.</p>
      </div>

      <!-- Step Progress Indicator -->
      <div class="wizard-progress">
        <div class="wizard-progress-step active" data-step="1" onclick="wizardGoToStep(1)">
          <div class="step-dot">1</div>
          <div class="step-label">Basic Info</div>
        </div>
        <div class="wizard-progress-step disabled" data-step="2" onclick="wizardGoToStep(2)">
          <div class="step-dot">2</div>
          <div class="step-label">Template</div>
        </div>
        <div class="wizard-progress-step disabled" data-step="3" onclick="wizardGoToStep(3)">
          <div class="step-dot">3</div>
          <div class="step-label">Sign-Ups</div>
        </div>
        <div class="wizard-progress-step disabled" data-step="4" onclick="wizardGoToStep(4)">
          <div class="step-dot">4</div>
          <div class="step-label">Your Links</div>
        </div>
        <div class="wizard-progress-step disabled" data-step="5" onclick="wizardGoToStep(5)">
          <div class="step-dot">5</div>
          <div class="step-label">Launch</div>
        </div>
      </div>

      <div class="wizard-content">
        <!-- Step 1: Basic Info -->
        <div class="wizard-step active" id="wizardStep1" data-testid="wizard-step-1">
          <div class="wizard-step-header">
            <h3><span>üìù</span> What's your event?</h3>
            <p class="step-description">Just 3 fields‚Äîname, date, and where it's happening.</p>
          </div>

          <div class="form-group">
            <label>Event Name *</label>
            <input type="text" id="wizardEventName" required placeholder="e.g., Friday Night Trivia, Summer Cookout" data-testid="wizard-event-name">
          </div>

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div class="form-group">
              <label>Event Date *</label>
              <input type="date" id="wizardEventDate" required data-testid="wizard-event-date">
            </div>
            <div class="form-group">
              <label>Venue / Location *</label>
              <input type="text" id="wizardEventVenue" required placeholder="e.g., The Local Pub" data-testid="wizard-event-venue">
            </div>
          </div>
        </div>

        <!-- Step 2: Choose Template -->
        <div class="wizard-step" id="wizardStep2" data-testid="wizard-step-2">
          <div class="wizard-step-header">
            <h3><span>üé®</span> What type of event is it?</h3>
            <p class="step-description">Pick a template to get the right setup‚Äîyou can customize later.</p>
          </div>

          <div id="wizardTemplatePicker" class="wizard-template-grid">
            <div class="template-loading">Loading templates...</div>
          </div>
          <input type="hidden" id="wizardTemplateId" value="bar_night">
        </div>

        <!-- Step 3: Sign-Ups (Optional) -->
        <div class="wizard-step" id="wizardStep3" data-testid="wizard-step-3">
          <div class="wizard-step-header">
            <h3><span>üìã</span> How will people sign up?</h3>
            <p class="step-description">Optional‚Äîyou can skip this and add it later.</p>
          </div>

          <div class="wizard-signup-options">
            <div class="wizard-signup-option" data-option="existing" onclick="selectWizardSignupOption('existing')">
              <div class="option-icon">üîó</div>
              <div class="option-content">
                <div class="option-title">I have a form already</div>
                <div class="option-desc">Paste a link to your Google Form, Eventbrite, etc.</div>
              </div>
            </div>

            <div class="wizard-signup-option" data-option="create" onclick="selectWizardSignupOption('create')">
              <div class="option-icon">‚ú®</div>
              <div class="option-content">
                <div class="option-title">Create a form for me</div>
                <div class="option-desc">We'll generate a simple Google Form you can customize.</div>
              </div>
            </div>

            <div class="wizard-signup-option" data-option="none" onclick="selectWizardSignupOption('none')">
              <div class="option-icon">‚è≠Ô∏è</div>
              <div class="option-content">
                <div class="option-title">No sign-ups needed</div>
                <div class="option-desc">Walk-ins only, or you'll handle it another way.</div>
              </div>
            </div>
          </div>

          <!-- Existing Form URL Input (shown when 'existing' selected) -->
          <div id="wizardExistingFormInput" style="display: none; margin-top: 16px;">
            <div class="form-group">
              <label>Your Sign-Up Form URL</label>
              <input type="url" id="wizardSignupUrl" placeholder="https://forms.google.com/..." data-testid="wizard-signup-url">
              <small class="muted">Paste the link where people can sign up</small>
            </div>
          </div>

          <!-- Create Form Status (shown when 'create' selected) -->
          <div id="wizardCreateFormStatus" style="display: none; margin-top: 16px; padding: 16px; background: var(--color-gray-50, #f8fafc); border-radius: 8px;">
            <p style="margin: 0; color: var(--color-gray-600, #475569);">
              <span id="wizardCreateFormIcon">üìù</span>
              <span id="wizardCreateFormText">We'll create your form when you proceed to the next step.</span>
            </p>
          </div>
        </div>

        <!-- Step 4: Your Links -->
        <div class="wizard-step" id="wizardStep4" data-testid="wizard-step-4">
          <div class="wizard-step-header">
            <h3><span>üîó</span> Your event is ready!</h3>
            <p class="step-description">Here are all the links and QR codes you need.</p>
          </div>

          <div class="wizard-links-grid">
            <!-- Public Page -->
            <div class="wizard-link-card" data-testid="wizard-link-public">
              <div class="link-icon">üåê</div>
              <div class="link-title">Public Page</div>
              <div class="link-desc">Share this with your customers</div>
              <div class="wizard-qr-preview" id="wizardQrPublic"></div>
              <div class="link-actions">
                <button class="btn-secondary btn-sm" onclick="copyWizardLink('public')">Copy Link</button>
                <button class="btn-secondary btn-sm" onclick="openWizardLink('public')">Open</button>
              </div>
            </div>

            <!-- Poster -->
            <div class="wizard-link-card" data-testid="wizard-link-poster">
              <div class="link-icon">üñºÔ∏è</div>
              <div class="link-title">Print Poster</div>
              <div class="link-desc">Ready to print with QR code</div>
              <div class="wizard-qr-preview" id="wizardQrPoster"></div>
              <div class="link-actions">
                <button class="btn-secondary btn-sm" onclick="copyWizardLink('poster')">Copy Link</button>
                <button class="btn-secondary btn-sm" onclick="openWizardLink('poster')">Open</button>
              </div>
            </div>

            <!-- TV Display -->
            <div class="wizard-link-card" data-testid="wizard-link-display">
              <div class="link-icon">üì∫</div>
              <div class="link-title">TV Display</div>
              <div class="link-desc">Put this on your bar screens</div>
              <div class="wizard-qr-preview" id="wizardQrDisplay"></div>
              <div class="link-actions">
                <button class="btn-secondary btn-sm" onclick="copyWizardLink('display')">Copy Link</button>
                <button class="btn-secondary btn-sm" onclick="openWizardLink('display')">Open</button>
              </div>
            </div>

            <!-- Shared Report -->
            <div class="wizard-link-card" data-testid="wizard-link-report">
              <div class="link-icon">üìä</div>
              <div class="link-title">Analytics Report</div>
              <div class="link-desc">Track views and engagement</div>
              <div class="wizard-qr-preview" id="wizardQrReport"></div>
              <div class="link-actions">
                <button class="btn-secondary btn-sm" onclick="copyWizardLink('report')">Copy Link</button>
                <button class="btn-secondary btn-sm" onclick="openWizardLink('report')">Open</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 5: Launch Checklist -->
        <div class="wizard-step" id="wizardStep5" data-testid="wizard-step-5">
          <div class="wizard-step-header">
            <h3><span>‚úÖ</span> Launch Checklist</h3>
            <p class="step-description">Verify everything works, then you're all set!</p>
          </div>

          <div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
              <span style="font-size: 2rem;">üéâ</span>
              <div>
                <h4 style="margin: 0 0 4px 0; color: #166534;">Your event is live!</h4>
                <p style="margin: 0; color: #15803d; font-size: 0.9rem;" id="wizardEventSummary">Event name ‚Ä¢ Date ‚Ä¢ Venue</p>
              </div>
            </div>
          </div>

          <div style="display: grid; gap: 12px;">
            <div class="wizard-checklist-item" style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: white; border: 1px solid var(--color-gray-200, #e2e8f0); border-radius: 8px;">
              <input type="checkbox" id="wizardCheckPublic" style="width: 20px; height: 20px; accent-color: #10b981;">
              <label for="wizardCheckPublic" style="flex: 1; cursor: pointer;">
                <strong>Public Page</strong> looks good
              </label>
              <button class="btn-secondary btn-sm" onclick="openWizardLink('public')">Open & Check</button>
            </div>

            <div class="wizard-checklist-item" style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: white; border: 1px solid var(--color-gray-200, #e2e8f0); border-radius: 8px;">
              <input type="checkbox" id="wizardCheckPoster" style="width: 20px; height: 20px; accent-color: #10b981;">
              <label for="wizardCheckPoster" style="flex: 1; cursor: pointer;">
                <strong>Poster</strong> is print-ready
              </label>
              <button class="btn-secondary btn-sm" onclick="openWizardLink('poster')">Open & Check</button>
            </div>

            <div class="wizard-checklist-item" style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: white; border: 1px solid var(--color-gray-200, #e2e8f0); border-radius: 8px;">
              <input type="checkbox" id="wizardCheckDisplay" style="width: 20px; height: 20px; accent-color: #10b981;">
              <label for="wizardCheckDisplay" style="flex: 1; cursor: pointer;">
                <strong>TV Display</strong> shows correctly
              </label>
              <button class="btn-secondary btn-sm" onclick="openWizardLink('display')">Open & Check</button>
            </div>

            <div class="wizard-checklist-item" style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: white; border: 1px solid var(--color-gray-200, #e2e8f0); border-radius: 8px;">
              <input type="checkbox" id="wizardCheckReport" style="width: 20px; height: 20px; accent-color: #10b981;">
              <label for="wizardCheckReport" style="flex: 1; cursor: pointer;">
                <strong>Analytics Report</strong> is accessible
              </label>
              <button class="btn-secondary btn-sm" onclick="openWizardLink('report')">Open & Check</button>
            </div>
          </div>

          <div style="margin-top: 24px; text-align: center; padding: 20px; background: var(--color-gray-50, #f8fafc); border-radius: 12px;">
            <p style="margin: 0 0 12px 0; color: var(--color-gray-600, #475569);">
              All set? You can close this wizard and manage your event from the dashboard below.
            </p>
            <button class="btn-primary" onclick="finishWizard()" data-testid="wizard-finish-btn">
              Done - Go to Dashboard
            </button>
          </div>
        </div>
      </div>

      <!-- Wizard Navigation -->
      <div class="wizard-nav" id="wizardNav">
        <div class="nav-left">
          <button class="btn-wizard-back" id="wizardBackBtn" onclick="wizardPrevStep()" style="display: none;">
            ‚Üê Back
          </button>
        </div>
        <div class="nav-right">
          <button class="btn-wizard-skip" id="wizardSkipBtn" onclick="wizardSkipStep()" style="display: none;">
            Skip for now
          </button>
          <button class="btn-wizard-next" id="wizardNextBtn" onclick="wizardNextStep()" disabled data-testid="wizard-next-btn">
            Next ‚Üí
          </button>
        </div>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- QUICK START GUIDE - "10 Minutes to Launch" Overview (HIDDEN - replaced by wizard) -->
    <!-- Shows bar owners the complete flow before they start                    -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section class="card quick-start-guide" id="quickStartGuide" data-testid="quick-start-guide" style="display: none;">
      <div class="quick-start-header">
        <span class="quick-start-icon">üöÄ</span>
        <div class="quick-start-title">
          <h2>Launch Your Event in 10 Minutes</h2>
          <p class="muted">Here's everything you'll do‚Äîno surprises, no tech headaches.</p>
        </div>
      </div>
      <div class="quick-start-steps">
        <div class="quick-start-step" data-step="1">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-header">
              <span class="step-title">Name your event</span>
              <span class="step-time">~2 min</span>
            </div>
            <p class="step-desc">Just 3 fields: event name, date, and venue. That's it.</p>
          </div>
        </div>
        <div class="quick-start-step" data-step="2">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-header">
              <span class="step-title">Set up sign-ups</span>
              <span class="step-time">~2 min</span>
            </div>
            <p class="step-desc">Add your registration form link, or let us create one for you.</p>
          </div>
        </div>
        <div class="quick-start-step" data-step="3">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-header">
              <span class="step-title">Print your poster</span>
              <span class="step-time">~1 min</span>
            </div>
            <p class="step-desc">One click, print-ready PDF with QR code. Put it on tables, windows, anywhere.</p>
          </div>
        </div>
        <div class="quick-start-step" data-step="4">
          <div class="step-number">4</div>
          <div class="step-content">
            <div class="step-header">
              <span class="step-title">Display on your TV</span>
              <span class="step-time">~1 min</span>
            </div>
            <p class="step-desc">Copy the link, open on your bar TV or tablet. Auto-refreshes, no babysitting.</p>
          </div>
        </div>
        <div class="quick-start-step" data-step="5">
          <div class="step-number">5</div>
          <div class="step-content">
            <div class="step-header">
              <span class="step-title">Share with your crowd</span>
              <span class="step-time">~2 min</span>
            </div>
            <p class="step-desc">Copy the public link or share directly to Facebook, Instagram, etc.</p>
          </div>
        </div>
        <div class="quick-start-step optional" data-step="6">
          <div class="step-number">~</div>
          <div class="step-content">
            <div class="step-header">
              <span class="step-title">Add sponsors</span>
              <span class="step-time">optional</span>
            </div>
            <p class="step-desc">Give each sponsor their own analytics link to show ROI.</p>
          </div>
        </div>
      </div>
      <div class="quick-start-footer">
        <p class="muted">Ready? Let's get started below.</p>
      </div>
    </section>

    <!-- Create Event Card - Simplified UX -->
    <section class="card" id="createCard">
      <div style="margin-bottom: 20px;">
        <div style="text-align: center; margin-bottom: 24px;">
          <span style="font-size: 3rem;">üçª</span>
          <h2 style="margin: 12px 0 8px 0;">Step 1: Create Your Event</h2>
          <p class="muted" style="margin: 0; max-width: 400px; margin-left: auto; margin-right: auto;">
            Just fill in 3 fields and we'll set up everything‚Äîposters, sign-up forms, TV display, and post-event reports.
          </p>
        </div>
      </div>
      <form id="createForm">
        <!-- Essential Fields Only -->
        <div class="form-group">
          <label>What's your event called? *</label>
          <input id="name" type="text" required placeholder="e.g., Friday Night Trivia, Summer Cookout">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>When is it? *</label>
            <input id="startDateISO" type="date" required>
          </div>
          <div class="form-group">
            <label>Where? *</label>
            <input id="venue" type="text" required placeholder="e.g., The Local Pub, Main Street">
          </div>
        </div>

        <!-- More Options - Collapsed by Default -->
        <div class="subsection" style="margin-top: 16px;">
          <div class="collapsible-header collapsed" onclick="toggleSection(this)" style="background: var(--color-gray-50, #f8fafc); border-radius: 8px; padding: 12px 16px;">
            <span style="color: var(--color-gray-600, #475569); font-size: 0.9rem;">More options (event type, display settings)</span>
            <span class="collapsible-icon" style="color: var(--color-gray-400, #94a3b8);">‚ñº</span>
          </div>
          <div class="collapsible-content" style="display: none; padding-top: 16px;">
            <!-- Event Template Section -->
            <div style="margin-bottom: 20px;">
              <label style="font-weight: 500; margin-bottom: 8px; display: block;">Event Type</label>
              <p class="muted" style="margin-bottom: 12px; font-size: 0.85rem;">Trivia night, fundraiser, tournament, league, or anything else</p>
              <div id="templatePicker" class="template-grid">
                <div class="template-loading">Loading options...</div>
              </div>
              <input type="hidden" id="templateId" value="custom">
            </div>

            <!-- CTA Label -->
            <div class="form-group" style="margin-bottom: 16px;">
              <label>Sign-up button text</label>
              <input id="ctaLabel" type="text" value="Sign Up" placeholder="e.g., Sign Up, Register, Join">
              <small class="muted">What should the main button say?</small>
            </div>

            <!-- Display Settings - Simplified -->
            <div style="border-top: 1px solid var(--color-gray-200, #e2e8f0); padding-top: 16px; margin-top: 8px;">
              <label style="font-weight: 500; margin-bottom: 12px; display: block;">What to show on your event pages</label>
              <div class="checkbox-group" style="margin-bottom: 12px;">
                <label class="checkbox-label">
                  <input type="checkbox" id="showVideo" checked>
                  <span>Video</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="showMap" checked>
                  <span>Map</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="showGallery" checked>
                  <span>Gallery</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="showSponsors" checked>
                  <span>Sponsors</span>
                </label>
              </div>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="showSchedule">
                  <span>Schedule</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="showStandings">
                  <span>Standings</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="showBracket">
                  <span>Bracket</span>
                </label>
              </div>
            </div>

            <!-- Advanced Display Toggles - Collapsed by Default -->
            <div class="subsection" data-testid="advanced-display-toggles">
              <div class="collapsible-header collapsed" onclick="toggleSection(this)" id="advancedDisplayTogglesHeader" style="background: transparent; padding: 8px 0; margin-bottom: 8px;">
                <span style="color: var(--color-gray-500, #64748b); font-size: 0.85rem;">Advanced display options</span>
                <span class="collapsible-icon" style="color: var(--color-gray-400, #94a3b8); font-size: 0.7rem;">‚ñº</span>
              </div>
              <div class="collapsible-content" id="advancedDisplayTogglesContent" style="display: none; padding-top: 4px;">
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="showSponsorBanner" checked>
                    <span>Sponsor banner on mobile</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showSponsorStrip" checked>
                    <span>Sponsor strip on TV</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showLeagueStrip" checked>
                    <span>External links on TV</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="showQRSection" checked>
                    <span>QR code section</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- V2 LEGACY UI - Hidden (internal use only) -->
        <div class="subsection" id="v2SectionsTogglePanel" style="display:none;">
          <div class="sections-grid" id="sectionsGrid">
            <label class="section-toggle"><input type="checkbox" id="sectionVideo" checked><span class="section-label">Video</span></label>
            <label class="section-toggle"><input type="checkbox" id="sectionMap" checked><span class="section-label">Map</span></label>
            <label class="section-toggle"><input type="checkbox" id="sectionSchedule" checked><span class="section-label">Schedule</span></label>
            <label class="section-toggle" id="v2SectionSponsorsToggle" style="display:none;"><input type="checkbox" id="sectionSponsors"><span class="section-label">Sponsors</span></label>
            <label class="section-toggle"><input type="checkbox" id="sectionNotes" checked><span class="section-label">Notes</span></label>
            <label class="section-toggle"><input type="checkbox" id="sectionGallery" checked><span class="section-label">Gallery</span></label>
          </div>
          <div id="sectionsModifiedNotice" class="sections-modified-notice">Sections modified from template defaults</div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- ADVANCED EVENT DETAILS - Collapsed by default for MVP flow      -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="subsection" id="advancedEventDetails" data-testid="advanced-event-details" style="margin-top: 16px;">
          <div class="collapsible-header collapsed" onclick="toggleSection(this)" id="advancedEventDetailsHeader" style="background: var(--color-gray-50, #f8fafc); border-radius: 8px; padding: 12px 16px;">
            <span style="color: var(--color-gray-600, #475569); font-size: 0.9rem;">Advanced event details (description, media, bio)</span>
            <span class="collapsible-icon" style="color: var(--color-gray-400, #94a3b8);">‚ñº</span>
          </div>
          <div class="collapsible-content" id="advancedEventDetailsContent" style="display: none; padding-top: 16px;">

            <!-- Summary Section -->
            <div class="form-group" id="v2SummarySection" data-testid="summary-section">
              <label style="font-weight: 500; margin-bottom: 8px; display: block;">Event Description</label>
              <textarea id="summary" placeholder="Brief event description (shown on public page)" rows="3" style="width: 100%; resize: vertical;"></textarea>
              <small class="muted">A short description that appears on your public event page</small>
            </div>

            <div class="form-group" style="margin-top: 12px;">
              <label>Description Link</label>
              <input id="summaryLink" type="url" placeholder="https://... (optional link for more info)">
            </div>

            <!-- Media Section -->
            <div style="border-top: 1px solid var(--color-gray-200, #e2e8f0); padding-top: 16px; margin-top: 16px;" id="v2MediaSection" data-testid="media-section">
              <label style="font-weight: 500; margin-bottom: 12px; display: block;">Media</label>
              <div class="form-group">
                <label>Event Image URL</label>
                <input id="imageUrl" type="url" placeholder="https://... (main event image)">
              </div>
              <div class="form-group" style="margin-top: 12px;">
                <label>Video URL</label>
                <input id="videoUrl" type="url" placeholder="YouTube, Vimeo, or direct video link">
              </div>
              <div class="form-group" style="margin-top: 12px;">
                <label>Gallery URLs</label>
                <textarea id="galleryUrls" placeholder="Comma-separated image URLs for gallery" rows="2" style="width: 100%; resize: vertical;"></textarea>
              </div>
            </div>

            <!-- Bio Section -->
            <div style="border-top: 1px solid var(--color-gray-200, #e2e8f0); padding-top: 16px; margin-top: 16px;" id="v2BioSection" data-testid="bio-section">
              <label style="font-weight: 500; margin-bottom: 12px; display: block;">Organizer Bio</label>
              <div class="form-group">
                <label>Bio</label>
                <textarea id="bio" placeholder="About the organizer or host" rows="3" style="width: 100%; resize: vertical;"></textarea>
              </div>
              <div class="form-group" style="margin-top: 12px;">
                <label>Bio Link</label>
                <input id="bioLink" type="url" placeholder="https://... (organizer website)">
              </div>
            </div>

          </div>
        </div>

        <!-- External Links Section (MVP Optional per externalData schema) -->
        <!-- V2 fields (statsUrl, scoreboardUrl, streamUrl, provider) are hidden within -->
        <div class="subsection" id="leagueBroadcastPanel" data-template-filter="rec_league,bocce,custom" data-testid="external-links-section">
          <div class="collapsible-header collapsed" onclick="toggleSection(this)" id="externalLinksHeader" style="background: var(--color-gray-50, #f8fafc); border-radius: 8px; padding: 12px 16px;">
            <span style="color: var(--color-gray-600, #475569); font-size: 0.9rem;">External links (schedule, standings, bracket)</span>
            <span class="collapsible-icon" style="color: var(--color-gray-400, #94a3b8);">‚ñº</span>
          </div>
          <div class="collapsible-content" id="externalLinksContent" style="display: none; padding-top: 16px;">
            <p class="muted" style="margin-bottom: 12px;">Link to schedules, standings, brackets, or other resources</p>

            <!-- Core League Links -->
            <div class="form-row">
              <div class="form-group">
                <label>üìÖ Schedule URL</label>
                <input id="scheduleUrl" type="url" placeholder="https://...">
                <small class="muted">Link to full schedule or season calendar</small>
              </div>
              <div class="form-group">
                <label>üìä Standings URL</label>
                <input id="standingsUrl" type="url" placeholder="https://...">
                <small class="muted">Link to current standings or rankings</small>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>üèÜ Bracket URL</label>
                <input id="bracketUrl" type="url" placeholder="https://...">
                <small class="muted">Tournament bracket or playoff tree</small>
              </div>
              <!-- V2 NOT IN SCHEMA - statsUrl not in externalData -->
              <div class="form-group" style="display:none;">
                <label>üìà Stats URL</label>
                <input id="statsUrl" type="url" placeholder="https://...">
                <small class="muted">Statistics or analytics hub</small>
              </div>
            </div>

            <!-- V2 Broadcast Links - NOT IN /schemas/event.schema.json -->
            <!-- ExternalData only has: scheduleUrl, standingsUrl, bracketUrl -->
            <div class="form-row" style="display:none;">
              <div class="form-group">
                <label>üì∫ Scoreboard URL</label>
                <input id="scoreboardUrl" type="url" placeholder="https://...">
                <small class="muted">Live scoreboard or game center</small>
              </div>
              <div class="form-group">
                <label>üé• Stream URL</label>
                <input id="streamUrl" type="url" placeholder="https://...">
                <small class="muted">Live or VOD stream (YouTube, Twitch, etc.)</small>
              </div>
            </div>

            <!-- V2 Provider Integration - NOT IN /schemas/event.schema.json -->
            <div class="form-row" style="display:none;">
              <div class="form-group">
                <label>Provider</label>
                <select id="providerName">
                  <option value="">-- Select Provider --</option>
                  <option value="Custom">Custom</option>
                  <option value="None">None</option>
                </select>
                <small class="muted">External platform if applicable</small>
              </div>
              <div class="form-group">
                <label>Provider Event ID</label>
                <input id="providerLeagueId" type="text" placeholder="External event ID">
                <small class="muted">ID from the external platform (optional)</small>
              </div>
            </div>
          </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <!-- V2 HIDDEN - Template-Specific Fields NOT IN /schemas/event.schema.json -->
        <!-- ticketUrl, donationUrl, albumUrl, registryUrl, vendorListUrl, goalAmount, raisedAmount -->
        <!-- V2 FEATURE ‚Äì NOT MVP: Add these fields to schema when template-specific features are ready -->
        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="subsection" style="display:none;">
          <div class="collapsible-header collapsed" onclick="toggleSection(this)">
            <h3>Additional Links (V2)</h3>
            <span class="collapsible-icon">‚ñº</span>
          </div>
          <div class="collapsible-content" style="display: none;">
            <p class="muted" style="margin-bottom: 12px;">Optional fields based on your event type</p>

            <!-- Registration & Tickets -->
            <div class="form-row">
              <div class="form-group">
                <label>üéüÔ∏è Ticket URL</label>
                <input id="ticketUrl" type="url" placeholder="Ticket purchase link">
              </div>
              <div class="form-group">
                <label>üíù Donation URL</label>
                <input id="donationUrl" type="url" placeholder="Donation page link">
              </div>
            </div>

            <!-- Photos & Registry -->
            <div class="form-row">
              <div class="form-group">
                <label>üì∏ Photo Album URL</label>
                <input id="albumUrl" type="url" placeholder="Google Photos, Flickr, etc.">
              </div>
              <div class="form-group">
                <label>üéÅ Gift Registry URL</label>
                <input id="registryUrl" type="url" placeholder="Amazon, Zola, etc.">
              </div>
            </div>

            <!-- Vendors (League fields moved to League & Broadcast panel) -->
            <div class="form-row">
              <div class="form-group">
                <label>üõí Vendor List URL</label>
                <input id="vendorListUrl" type="url" placeholder="List of vendors">
              </div>
              <div class="form-group">
                <!-- Empty for layout balance -->
              </div>
            </div>

            <!-- Fundraising -->
            <div class="form-row">
              <div class="form-group">
                <label>üéØ Fundraising Goal ($)</label>
                <input id="goalAmount" type="number" placeholder="5000">
              </div>
              <div class="form-group">
                <label>üí∞ Amount Raised ($)</label>
                <input id="raisedAmount" type="number" placeholder="2500">
              </div>
            </div>
          </div>
        </div>

        <div class="button-group" style="margin-top: 24px;">
          <button class="btn-primary" type="submit" style="font-size: 1rem; padding: 14px 32px;">Create Event</button>
          <button class="btn-secondary" type="button" onclick="clearForm()">Start Over</button>
          <? if (demoMode && ZEB.DEMO_MODE.showPrefillButton) { ?>
          <button class="demo-prefill-btn" type="button" onclick="window.demoFillSampleEvent && window.demoFillSampleEvent()">
            Fill Sample Data
          </button>
          <? } ?>
        </div>
      </form>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- SEVEN-CARD ADMIN SHELL - Flow-First Layout for Bar Managers            -->
    <!-- Card 1: Event Basics | Card 2: Sponsors | Card 3: Sign-Up Form         -->
    <!-- Card 4: Poster | Card 5: TV Display | Card 6: Public Page              -->
    <!-- Card 7: Shared Report                                                   -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="eventCard" style="display:none;">

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- HAPPY PATH CHECKLIST - Quick guide for first-time bar owners        -->
      <!-- Time estimates help users understand this is truly a ~10 min process -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="happy-path-checklist" id="happyPathChecklist" data-testid="happy-path-checklist">
        <div class="happy-path-header">
          <span style="font-size: 1.2rem;">üöÄ</span>
          <h3>Finish Setup (~8 min left)</h3>
          <span class="progress-text" id="checklistProgress">1 of 6 done</span>
        </div>
        <div class="checklist-items">
          <div class="checklist-item done" id="checklist-event" onclick="scrollToCard('card1EventBasics')" data-testid="checklist-event">
            <span class="check-indicator done">‚úì</span>
            <span class="item-label">Name your event <span class="time-estimate">~2 min</span></span>
            <span class="goto-arrow">‚Üí</span>
          </div>
          <div class="checklist-item" id="checklist-signup" onclick="scrollToCard('card3SignUp')" data-testid="checklist-signup">
            <span class="check-indicator pending"></span>
            <span class="item-label">Set up sign-ups <span class="time-estimate">~2 min</span></span>
            <span class="goto-arrow">‚Üí</span>
          </div>
          <div class="checklist-item" id="checklist-poster" onclick="scrollToCard('card4Poster')" data-testid="checklist-poster">
            <span class="check-indicator pending"></span>
            <span class="item-label">Print your poster <span class="time-estimate">~1 min</span></span>
            <span class="goto-arrow">‚Üí</span>
          </div>
          <div class="checklist-item" id="checklist-display" onclick="scrollToCard('card5Display')" data-testid="checklist-display">
            <span class="check-indicator pending"></span>
            <span class="item-label">Display on TV <span class="time-estimate">~1 min</span></span>
            <span class="goto-arrow">‚Üí</span>
          </div>
          <div class="checklist-item" id="checklist-public" onclick="scrollToCard('card6PublicPage')" data-testid="checklist-public">
            <span class="check-indicator pending"></span>
            <span class="item-label">Share with crowd <span class="time-estimate">~2 min</span></span>
            <span class="goto-arrow">‚Üí</span>
          </div>
          <div class="checklist-item optional-pending" id="checklist-sponsors" onclick="scrollToCard('card2Sponsors')" data-testid="checklist-sponsors">
            <span class="check-indicator optional">~</span>
            <span class="item-label">Add sponsors <span class="optional-tag">(optional)</span></span>
            <span class="goto-arrow">‚Üí</span>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- CARD 1: EVENT BASICS - What you just created                        -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <section class="card" id="card1EventBasics" style="border-left: 4px solid #10b981;">
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="font-size: 2.5rem; line-height: 1;">‚úÖ</div>
          <div style="flex: 1;">
            <h2 style="margin: 0 0 8px 0; color: var(--color-gray-800, #1e293b);">Your Event is Live!</h2>
            <div id="eventInfo" style="font-size: 1rem; color: var(--color-gray-600, #475569);"></div>
            <p style="margin: 12px 0 0 0; font-size: 0.9rem; color: var(--color-gray-500, #64748b);">
              Everything's set up. Use the tools below to promote your event and track results.
            </p>
          </div>
        </div>
      </section>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- CARD 2: SPONSORS - They're paying, so they come first               -->
      <!-- Mobile: Collapsed by default (expand for sponsor management)        -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <section class="card card-mobile-collapsible" id="card2Sponsors" style="border-left: 4px solid #c026d3;" data-mobile-collapse="true">
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="font-size: 2rem; line-height: 1;">ü§ù</div>
          <div style="flex: 1;">
            <h3 style="margin: 0 0 4px 0; color: var(--color-gray-800, #1e293b);">Sponsors</h3>
            <div class="card-collapse-toggle" onclick="toggleMobileCard(this.closest('.card-mobile-collapsible'))">
              <span class="collapse-hint">Tap to expand</span>
              <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="card-collapsible-body">
              <p style="margin: 0 0 16px 0; font-size: 0.9rem; color: var(--color-gray-500, #64748b);">
                Give each sponsor their own analytics link to show how their logo performed.
              </p>

              <!-- Sponsor Placement Guide -->
              <div id="sponsorPlacementGuide" style="background: var(--color-gray-50, #f8fafc); border-radius: 8px; padding: 12px; margin-bottom: 12px; display: none;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                  <span style="font-size: 1rem;">üìç</span>
                  <strong style="font-size: 0.8rem; color: var(--color-gray-700, #334155);">Where Sponsor Logos Appear</strong>
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 6px; font-size: 0.75rem; margin-bottom: 12px;">
                  <span style="background: #dbeafe; color: #1e40af; padding: 3px 8px; border-radius: 12px;" title="Mobile/web event info page">Public</span>
                  <span style="background: #dcfce7; color: #166534; padding: 3px 8px; border-radius: 12px;" title="TV/kiosk display screen">Display</span>
                  <span style="background: #fef3c7; color: #92400e; padding: 3px 8px; border-radius: 12px;" title="Printable poster">Poster</span>
                  <span style="background: #f3e8ff; color: #7e22ce; padding: 3px 8px; border-radius: 12px;" title="Rotating TV banner">TV Banner</span>
                </div>
                <div style="font-size: 0.7rem; color: var(--color-gray-500, #64748b); margin-bottom: 12px;">
                  Each sponsor's logo appears on the surface matching their <em>placement</em> setting.
                </div>
                <div style="border-top: 1px solid var(--color-gray-200, #e2e8f0); padding-top: 12px;">
                  <div style="font-size: 0.75rem; font-weight: 600; color: var(--color-gray-600, #475569); margin-bottom: 8px;">Preview Event Surfaces:</div>
                  <div id="sponsorPreviewLinks" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
                </div>
              </div>

              <div id="sponsorPerformanceCard" style="background: linear-gradient(135deg, #fdf4ff 0%, #f5d0fe 100%); border-radius: 8px; padding: 16px;">
                <div id="sponsorReportsList" style="margin-bottom: 12px;"></div>
                <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                  <input type="text" id="customSponsorId" placeholder="Enter sponsor name" style="flex: 1; min-width: 150px; padding: 10px 12px; border-radius: 6px; border: 1px solid #e879f9;">
                  <button class="btn-primary" onclick="generateSponsorReportLink()" style="background: #c026d3;">Generate Link</button>
                </div>
                <div id="customSponsorLinkOutput" style="margin-top: 12px; display: none;">
                  <div style="background: white; border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                    <input type="text" id="customSponsorLinkField" readonly style="width: 100%; font-size: 0.8rem; border: none; background: transparent; font-family: monospace;">
                  </div>
                  <button class="btn-secondary" onclick="copyCustomSponsorLink()">Copy Sponsor Link</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- CARD 3: SIGN-UP FORM - Get people registered                        -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <section class="card" id="card3SignUp" style="border-left: 4px solid #059669;">
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="font-size: 2rem; line-height: 1;">üìù</div>
          <div style="flex: 1;">
            <h3 style="margin: 0 0 4px 0; color: var(--color-gray-800, #1e293b);">Sign-Up Forms</h3>
            <p style="margin: 0 0 16px 0; font-size: 0.9rem; color: var(--color-gray-500, #64748b);">
              Get people registered before the event, check them in at the door, or sign up walk-ins on the spot.
            </p>

            <div id="signupSummary" style="background: var(--color-gray-50, #f8fafc); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
              <p style="margin: 0; font-size: 0.9rem; color: var(--color-gray-600, #475569);">
                <span id="signupCount" style="font-weight: 600;">0</span> sign-ups so far
              </p>
            </div>

            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <button class="btn-primary" onclick="configureSignup()" style="background: #059669;">Configure Forms</button>
              <button class="btn-secondary <? if (demoMode && ZEB.DEMO_MODE.highlightNewFeatures) { ?>demo-new-feature<? } ?>" onclick="openFormsTemplates()">
                Create Google Forms
                <? if (demoMode && ZEB.DEMO_MODE.highlightNewFeatures) { ?><span class="demo-new-badge">NEW</span><? } ?>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- CARD 4: POSTER PAGE - Print and display                             -->
      <!-- Mobile: Collapsed by default (expand to get poster link)            -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <section class="card card-mobile-collapsible" id="card4Poster" style="border-left: 4px solid #d97706;" data-mobile-collapse="true">
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="font-size: 2rem; line-height: 1;">üñºÔ∏è</div>
          <div style="flex: 1;">
            <h3 style="margin: 0 0 4px 0; color: var(--color-gray-800, #1e293b);">Poster Page</h3>
            <div class="card-collapse-toggle" onclick="toggleMobileCard(this.closest('.card-mobile-collapsible'))">
              <span class="collapse-hint">Tap to expand</span>
              <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="card-collapsible-body">
              <p style="margin: 0 0 16px 0; font-size: 0.9rem; color: var(--color-gray-500, #64748b);">
                Print-ready page with QR code. Great for flyers, table tents, or window displays.
              </p>

              <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                  <a id="lnkPoster" target="_blank" rel="noopener" style="flex: 1; font-size: 0.85rem; word-break: break-all; color: #92400e; font-family: monospace;"></a>
                  <div id="qrPosterPreview" style="flex-shrink: 0;"></div>
                </div>
              </div>

              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="btn-primary" onclick="copy('lnkPoster')" style="background: #d97706;">Copy Link</button>
                <button class="btn-secondary" onclick="window.open(document.getElementById('lnkPoster').href)">Open Poster</button>
                <button class="btn-secondary" onclick="showPosterQR()">Show QR Code</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- CARD 5: TV DISPLAY - Put it on your bar screens                     -->
      <!-- Mobile: Collapsed by default (expand for TV link)                   -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <section class="card card-mobile-collapsible" id="card5Display" style="border-left: 4px solid #2563eb;" data-mobile-collapse="true">
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="font-size: 2rem; line-height: 1;">üì∫</div>
          <div style="flex: 1;">
            <h3 style="margin: 0 0 4px 0; color: var(--color-gray-800, #1e293b);">TV Display</h3>
            <div class="card-collapse-toggle" onclick="toggleMobileCard(this.closest('.card-mobile-collapsible'))">
              <span class="collapse-hint">Tap to expand</span>
              <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="card-collapsible-body">
              <p style="margin: 0 0 16px 0; font-size: 0.9rem; color: var(--color-gray-500, #64748b);">
                Open this on your bar TV or tablet. It auto-rotates sponsor logos and keeps the event info visible.
              </p>

              <div style="background: var(--color-gray-50, #f8fafc); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                <a id="lnkDisplay" target="_blank" rel="noopener" style="font-size: 0.85rem; word-break: break-all; color: #2563eb; font-family: monospace;"></a>
              </div>

              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="btn-primary" onclick="copy('lnkDisplay')" style="background: #2563eb;">Copy Link</button>
                <button class="btn-secondary" onclick="window.open(document.getElementById('lnkDisplay').href)">Open on TV</button>
                <button class="btn-secondary" onclick="configureDisplay()">Settings</button>
              </div>

              <!-- TV Tips -->
              <div style="margin-top: 16px; padding: 12px; background: #eff6ff; border-radius: 8px; border: 1px solid #bfdbfe;">
                <p style="margin: 0; font-size: 0.8rem; color: #1e40af;">
                  <strong>Tip:</strong> Use your browser's fullscreen mode (F11) for the best look. The display will auto-refresh every few minutes.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- CARD 6: PUBLIC PAGE - Share with customers                          -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <section class="card" id="card6PublicPage" style="border-left: 4px solid #16a34a;">
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="font-size: 2rem; line-height: 1;">üåê</div>
          <div style="flex: 1;">
            <h3 style="margin: 0 0 4px 0; color: var(--color-gray-800, #1e293b);">Public Page</h3>
            <p style="margin: 0 0 16px 0; font-size: 0.9rem; color: var(--color-gray-500, #64748b);">
              This is the link your customers see. Share it on social media, text it to regulars, or add it to your website.
            </p>

            <div style="background: var(--color-gray-50, #f8fafc); border-radius: 8px; padding: 12px; margin-bottom: 12px; display: flex; align-items: center; gap: 12px;">
              <a id="lnkPublic" target="_blank" rel="noopener" style="flex: 1; font-size: 0.85rem; word-break: break-all; color: #16a34a; font-family: monospace;"></a>
              <div id="qrPublicPreview" style="flex-shrink: 0;"></div>
            </div>

            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <button class="btn-primary" onclick="copy('lnkPublic')" style="background: #16a34a;">Copy Link</button>
              <button class="btn-secondary" onclick="window.open(document.getElementById('lnkPublic').href)">Open Page</button>
              <button class="btn-secondary" onclick="showPublicQR()">Show QR Code</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- CARD 7: SHARED REPORT - Post-event analytics                        -->
      <!-- Mobile: Collapsed by default (expand for report link)               -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <section class="card card-mobile-collapsible" id="card7Report" style="border-left: 4px solid #7c3aed;" data-mobile-collapse="true">
        <div style="display: flex; align-items: flex-start; gap: 16px;">
          <div style="font-size: 2rem; line-height: 1;">üìä</div>
          <div style="flex: 1;">
            <h3 style="margin: 0 0 4px 0; color: var(--color-gray-800, #1e293b);">Shared Report</h3>
            <div class="card-collapse-toggle" onclick="toggleMobileCard(this.closest('.card-mobile-collapsible'))">
              <span class="collapse-hint">Tap to expand</span>
              <span class="collapse-icon">‚ñº</span>
            </div>
            <div class="card-collapsible-body">
              <p style="margin: 0 0 16px 0; font-size: 0.9rem; color: var(--color-gray-500, #64748b);">
                Share this after your event. Shows views, impressions, and engagement metrics for sponsors.
              </p>

              <div style="background: var(--color-gray-50, #f8fafc); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                <a id="lnkReport" target="_blank" rel="noopener" style="font-size: 0.85rem; word-break: break-all; color: #7c3aed; font-family: monospace;"></a>
              </div>

              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="btn-primary" onclick="copy('lnkReport')" style="background: #7c3aed;">Copy Report Link</button>
                <button class="btn-secondary" onclick="window.open(document.getElementById('lnkReport').href)">View Report</button>
              </div>
              <div id="qrSharedReport" style="text-align:center;margin-top:12px;display:none;"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- DIAGNOSTICS & ADVANCED - For power users                            -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <section class="card" id="cardDiagnostics" style="border-left: 4px solid var(--color-gray-400, #94a3b8);">
        <div class="collapsible-header collapsed" onclick="toggleSection(this)" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 1.5rem;">üîß</span>
            <div>
              <h3 style="margin: 0; color: var(--color-gray-600, #475569); font-size: 1rem;">Advanced Tools</h3>
              <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: var(--color-gray-400, #94a3b8);">Event ID and technical details</p>
            </div>
          </div>
          <span class="collapsible-icon" style="color: var(--color-gray-400, #94a3b8); font-size: 0.8rem;">‚ñº</span>
        </div>
        <div class="collapsible-content" style="display: none; padding-top: 20px;">
          <!-- Event ID Info -->
          <div style="padding: 12px; background: var(--color-gray-50, #f8fafc); border-radius: 8px; border: 1px solid var(--color-gray-200, #e2e8f0);">
            <p style="margin: 0 0 8px 0; font-size: 0.8rem; color: var(--color-gray-500, #64748b);">
              <strong>Event ID:</strong> <code id="eventIdDisplay" style="font-family: monospace; background: white; padding: 2px 6px; border-radius: 4px;"></code>
            </p>
            <p style="margin: 0; font-size: 0.75rem; color: var(--color-gray-400, #94a3b8);">
              Use this ID if you need technical support or want to reference this event in other systems.
            </p>
          </div>
        </div>
      </section>

      <!-- Create Another Event -->
      <div style="margin-top: 24px; padding: 20px; text-align: center; border-top: 1px solid var(--color-gray-200, #e2e8f0);">
        <button class="btn-secondary" onclick="clearForm(); document.getElementById('createCard').scrollIntoView({behavior: 'smooth'});" style="padding: 12px 24px;">
          Create Another Event
        </button>
      </div>
    </div>

    <!-- Sign Up Forms -->
    <section id="signupCard" class="card" style="display:none;">
      <h2>Sign-Up Forms</h2>
      <p class="muted">Add links to your Google Forms (or any form) for different stages of your event.</p>

      <div class="form-row">
        <div class="form-group">
          <label>Registration (before the event)</label>
          <input type="url" id="registerUrl" placeholder="Paste your form link here...">
          <small class="muted">People sign up ahead of time</small>
        </div>

        <div class="form-group">
          <label>Check-In (at the door)</label>
          <input type="url" id="checkinUrl" placeholder="Paste your form link here...">
          <small class="muted">Mark attendance when they arrive</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Walk-In (same day signups)</label>
          <input type="url" id="walkinUrl" placeholder="Paste your form link here...">
          <small class="muted">For people who show up without registering</small>
        </div>

        <div class="form-group">
          <label>Survey (after the event)</label>
          <input type="url" id="surveyUrl" placeholder="Paste your form link here...">
          <small class="muted">Get feedback from attendees</small>
        </div>
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="saveAllSignupForms()">Save</button>
        <button class="btn-secondary" onclick="closeSignupConfig()">Cancel</button>
      </div>
    </section>

    <!-- Google Forms Templates -->
    <section id="formsCard" class="card" style="display:none;">
      <h2>Create Google Forms</h2>
      <p class="muted">Click to create ready-to-use forms. You'll get a short link to share with attendees.</p>

      <div class="form-row">
        <div class="form-group">
          <label>Check-In Form</label>
          <small class="muted">For attendees to check in when they arrive</small>
          <button class="btn-secondary" onclick="createFormTemplate('check-in')" style="margin-top: 8px;">
            Create Form
          </button>
          <div id="checkin-form-display" style="margin-top: 8px;"></div>
        </div>

        <div class="form-group">
          <label>Walk-In Form</label>
          <small class="muted">For people who show up without registering</small>
          <button class="btn-secondary" onclick="createFormTemplate('walk-in')" style="margin-top: 8px;">
            Create Form
          </button>
          <div id="walkin-form-display" style="margin-top: 8px;"></div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Feedback Survey</label>
          <small class="muted">Ask attendees how the event went</small>
          <button class="btn-secondary" onclick="createFormTemplate('survey')" style="margin-top: 8px;">
            Create Form
          </button>
          <div id="survey-form-display" style="margin-top: 8px;"></div>
        </div>

        <div class="form-group">
          <label style="color: var(--color-gray-500, #64748b);">How it works</label>
          <small class="muted">
            1. Click "Create Form" to generate a form<br>
            2. Copy the short link to share<br>
            3. Click "Edit Form" to customize questions<br>
            4. Responses go to a spreadsheet automatically
          </small>
        </div>
      </div>

      <div class="button-group">
        <button class="btn-secondary" onclick="closeFormsTemplates()">Done</button>
      </div>
    </section>

    <!-- TV Display Configuration -->
    <section id="displayCard" class="card" style="display:none;">
      <h2>TV Display Settings</h2>
      <p class="muted">Configure what shows on your TV screen or kiosk display.</p>

      <div class="form-group">
        <label>What should the TV show?</label>
        <select id="displayMode" onchange="toggleDisplayMode()">
          <option value="public">Event page (same as mobile)</option>
          <option value="dynamic">Slideshow (rotate through content)</option>
        </select>
      </div>

      <div id="dynamicConfig" style="display:none; margin-top: 16px; padding: 16px; background: var(--color-gray-50, #f8fafc); border-radius: 8px;">
        <label style="font-weight: 500; margin-bottom: 8px; display: block;">Slideshow Content</label>
        <p class="muted" style="margin-bottom: 12px;">Add links to rotate through. YouTube, Vimeo, and web pages work great.</p>
        <div id="urlList"></div>
        <button class="btn-secondary" onclick="addUrl()" style="margin-top: 8px;">Add Another</button>
      </div>

      <!-- V2: Sponsors hidden until V2 release -->
      <div id="v2SponsorsSection" style="display:none;">
        <h3>Sponsors</h3>
        <div id="sponsorList"></div>
        <button class="btn-secondary" onclick="addSponsor()">Add Sponsor</button>
      </div>

      <div class="button-group" style="margin-top: 20px;">
        <button class="btn-primary" onclick="saveDisplayConfig()">Save</button>
        <button class="btn-secondary" onclick="closeDisplayConfig()">Cancel</button>
      </div>
    </section>

  </main>

  <div id="overlay" class="loading-overlay"><div class="spinner"></div><p>Working‚Ä¶</p></div>

  <script>
    const BRAND = '<?= brandId ?>';
    const SCOPE = '<?= scope ?>';

    // Event state for edit mode - tracks current event's immutable/server-set fields
    const STATE = {
      id: null,
      slug: null,
      createdAtISO: null
    };

    let currentEventId = null;  // Legacy compat - will migrate to STATE.id
    let availableTemplates = [];
    let defaultTemplateId = 'custom';

    // === Helper Functions ===
    function generateId() {
      // Generate UUID v4-like ID
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = (crypto.getRandomValues(new Uint8Array(1))[0] & 15) >> (c === 'x' ? 0 : 3);
        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
      });
    }

    function slugify(text) {
      return text.toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .substring(0, 50);
    }

    // === MVP Template System (Stage-Gate) ===
    // Templates are grouped by category and filtered by tier
    // Only MVP-tier templates are shown until V2 features ship
    let templateGroups = [];

    async function loadTemplates() {
      try {
        console.log('[Templates] Loading templates for brand:', BRAND);
        const res = await NU.rpc('api_getEventTemplates', { brandId: BRAND });
        console.log('[Templates] Response:', res);

        if (res.ok && res.value) {
          availableTemplates = res.value.items || [];
          templateGroups = res.value.groups || [];
          defaultTemplateId = res.value.defaultTemplateId || 'custom';
          console.log('[Templates] Loaded', availableTemplates.length, 'templates in', templateGroups.length, 'groups, default:', defaultTemplateId);
          console.log('[Templates] Tier filter:', res.value.tier || 'none');
          renderTemplatePicker();
          // Select default template
          selectTemplate(defaultTemplateId);
        } else {
          console.warn('[Templates] API returned error:', res.code, res.message);
          document.getElementById('templatePicker').innerHTML =
            `<p class="muted">Could not load templates. ${res.message || 'Using defaults.'}</p>`;
          updateTemplatePanelVisibility('custom'); // Show league panel for custom fallback
        }
      } catch (e) {
        console.error('[Templates] Exception loading templates:', e);
        document.getElementById('templatePicker').innerHTML =
          '<p class="muted">Could not load templates. Using defaults.</p>';
        updateTemplatePanelVisibility('custom'); // Show league panel for custom fallback
      }
    }

    function renderTemplatePicker() {
      const picker = document.getElementById('templatePicker');
      if (!availableTemplates.length) {
        picker.innerHTML = '<p class="muted">No templates available.</p>';
        return;
      }

      const sectionIcons = { video: 'üé¨', map: 'üìç', schedule: 'üìÖ', sponsors: 'ü§ù', notes: 'üìù', gallery: 'üñºÔ∏è' };

      // Render grouped templates if groups are available
      if (templateGroups.length > 0) {
        picker.innerHTML = templateGroups.map(group => {
          const groupTemplates = group.templates.map(t => renderTemplateCard(t, sectionIcons)).join('');
          return `
            <div class="template-group" data-group-id="${NU.esc(group.id)}">
              <div class="template-group-header">
                <span class="template-group-icon">${group.icon || 'üìÅ'}</span>
                <span class="template-group-label">${NU.esc(group.label || group.id)}</span>
                <span class="template-group-desc">${NU.esc(group.description || '')}</span>
              </div>
              <div class="template-group-grid">${groupTemplates}</div>
            </div>
          `;
        }).join('');
      } else {
        // Fallback to flat grid (backward compatibility)
        picker.innerHTML = `<div class="template-grid">${availableTemplates.map(t => renderTemplateCard(t, sectionIcons)).join('')}</div>`;
      }
    }

    function renderTemplateCard(t, sectionIcons) {
      const isRecommended = t.id === defaultTemplateId;
      const sectionPreview = Object.keys(sectionIcons).map(key => {
        const on = t.sections && t.sections[key];
        return `<span class="${on ? '' : 'off'}">${sectionIcons[key]}</span>`;
      }).join('');

      return `
        <div class="template-card" data-template-id="${NU.esc(t.id)}" onclick="selectTemplate('${NU.esc(t.id)}')">
          ${isRecommended ? '<span class="recommended-badge">Recommended</span>' : ''}
          <div class="template-icon">${t.icon || 'üìã'}</div>
          <div class="template-name">${NU.esc(t.label || t.id)}</div>
          <div class="template-desc">${NU.esc(t.description || '')}</div>
          <div class="template-sections">${sectionPreview}</div>
        </div>
      `;
    }

    let currentTemplateSections = null; // Track for modification detection

    function selectTemplate(templateId) {
      // Update hidden input
      document.getElementById('templateId').value = templateId;

      // Update visual selection
      document.querySelectorAll('.template-card').forEach(card => {
        card.classList.toggle('selected', card.dataset.templateId === templateId);
      });

      // Find template and apply section defaults
      const tpl = availableTemplates.find(t => t.id === templateId);
      if (tpl && tpl.sections) {
        currentTemplateSections = { ...tpl.sections };
        applySectionDefaults(tpl.sections);
        checkSectionsModified(); // Reset notice
      }

      // Feature 4: Apply template-specific defaults (standings, bracket for league templates)
      applyTemplateSpecificDefaults(templateId);

      // Update template-filtered panel visibility
      updateTemplatePanelVisibility(templateId);
    }

    /**
     * Show/hide panels based on data-template-filter attribute
     * Panels with data-template-filter="rec_league,custom" only show for those templates
     */
    function updateTemplatePanelVisibility(templateId) {
      document.querySelectorAll('[data-template-filter]').forEach(panel => {
        const allowedTemplates = panel.dataset.templateFilter.split(',').map(t => t.trim());
        const shouldShow = allowedTemplates.includes(templateId);
        panel.style.display = shouldShow ? '' : 'none';
      });
    }

    function checkSectionsModified() {
      if (!currentTemplateSections) return;
      const current = getSectionsFromForm();
      const modified = Object.keys(currentTemplateSections).some(
        key => current[key] !== currentTemplateSections[key]
      );
      const notice = document.getElementById('sectionsModifiedNotice');
      notice.classList.toggle('visible', modified);
    }

    // Add change listeners to section checkboxes
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('#sectionsGrid input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', checkSectionsModified);
      });
    });

    /**
     * Apply template section defaults to form checkboxes
     * Feature 4: Template-Aware Section Toggles
     * Maps template.sections to both legacy checkboxes and Display Settings checkboxes
     */
    function applySectionDefaults(sections) {
      // Legacy section checkboxes (v2SectionsTogglePanel - hidden in MVP)
      const legacySectionMap = {
        video: 'sectionVideo',
        map: 'sectionMap',
        schedule: 'sectionSchedule',
        sponsors: 'sectionSponsors',
        notes: 'sectionNotes',
        gallery: 'sectionGallery'
      };
      Object.keys(legacySectionMap).forEach(key => {
        const checkbox = document.getElementById(legacySectionMap[key]);
        if (checkbox && Object.prototype.hasOwnProperty.call(sections, key)) {
          checkbox.checked = !!sections[key];
        }
      });

      // Display Settings checkboxes (template-aware toggles - Feature 4)
      const settingsMap = {
        video: 'showVideo',
        map: 'showMap',
        gallery: 'showGallery',
        schedule: 'showSchedule',
        sponsors: 'showSponsors'
      };
      Object.keys(settingsMap).forEach(key => {
        const checkbox = document.getElementById(settingsMap[key]);
        if (checkbox && Object.prototype.hasOwnProperty.call(sections, key)) {
          checkbox.checked = !!sections[key];
        }
      });

      // Template-specific defaults for standings/bracket (league templates)
      // These don't come from sections but from template ID logic
    }

    /**
     * Apply template-specific defaults for standings and bracket
     * Called from selectTemplate() after applySectionDefaults()
     */
    function applyTemplateSpecificDefaults(templateId) {
      // League templates default to showing standings
      const leagueTemplates = ['rec_league', 'darts', 'bags', 'pinball'];
      const showStandingsCheckbox = document.getElementById('showStandings');
      if (showStandingsCheckbox) {
        showStandingsCheckbox.checked = leagueTemplates.includes(templateId);
      }

      // Tournament templates default to showing bracket
      const bracketTemplates = ['rec_league', 'bags'];
      const showBracketCheckbox = document.getElementById('showBracket');
      if (showBracketCheckbox) {
        showBracketCheckbox.checked = bracketTemplates.includes(templateId);
      }
    }

    function getSectionsFromForm() {
      return {
        video: document.getElementById('sectionVideo').checked,
        map: document.getElementById('sectionMap').checked,
        schedule: document.getElementById('sectionSchedule').checked,
        sponsors: document.getElementById('sectionSponsors').checked,
        notes: document.getElementById('sectionNotes').checked,
        gallery: document.getElementById('sectionGallery').checked
      };
    }

    // Load templates when page loads
    document.addEventListener('DOMContentLoaded', loadTemplates);

    /**
     * Build canonical event object from form inputs.
     * MUST match /schemas/event.schema.json (MVP-frozen v2.2)
     * See EVENT_CONTRACT.md for field documentation.
     * Uses STATE for edit mode (preserves id, slug, createdAtISO from existing event).
     */
    function buildEventFromForm() {
      const name = document.getElementById('name').value.trim();
      const startDateISO = document.getElementById('startDateISO').value;
      const venue = document.getElementById('venue').value.trim();
      const ctaLabel = document.getElementById('ctaLabel').value.trim() || 'Sign Up';

      const now = new Date().toISOString();

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // CANONICAL EVENT SHAPE - MUST match /schemas/event.schema.json (MVP subset)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      return {
        // Identity (MVP Required) - use STATE for edit mode
        id: STATE.id ?? generateId(),
        slug: STATE.slug ?? slugify(name),
        name: name,
        startDateISO: startDateISO,
        venue: venue,

        // Links (MVP Required) - server will fill these
        links: {
          publicUrl: '',
          displayUrl: '',
          posterUrl: '',
          signupUrl: ''
        },

        // QR Codes (MVP Required) - server will generate
        qr: {},

        // CTAs (MVP Required)
        ctas: {
          primary: {
            label: ctaLabel,
            url: ''  // Server injects signupUrl
          },
          secondary: null
        },

        // Schedule/Standings/Bracket (MVP Optional)
        schedule: null,
        standings: null,
        bracket: null,

        // Settings (MVP Required) - must match schema Settings definition
        settings: {
          // Data Section Visibility (MVP Required)
          showSchedule: document.getElementById('showSchedule').checked,
          showStandings: document.getElementById('showStandings').checked,
          showBracket: document.getElementById('showBracket').checked,
          // Content Section Visibility (Template-Aware - Feature 4)
          showVideo: document.getElementById('showVideo')?.checked ?? true,
          showMap: document.getElementById('showMap')?.checked ?? true,
          showGallery: document.getElementById('showGallery')?.checked ?? true,
          // Master toggle for sponsors (template default, user can override)
          showSponsors: document.getElementById('showSponsors')?.checked ?? true,
          // MVP Optional - surface-specific toggles (per schema)
          showSponsorBanner: document.getElementById('showSponsorBanner')?.checked ?? true,
          showSponsorStrip: document.getElementById('showSponsorStrip')?.checked ?? true,
          showLeagueStrip: document.getElementById('showLeagueStrip')?.checked ?? true,
          showQRSection: document.getElementById('showQRSection')?.checked ?? true
        },

        // V2 Optional fields - null per schema (server hydrates when needed)
        sponsors: null,
        media: null,
        externalData: null,

        // Reserved fields - null per schema (not yet implemented)
        analytics: null,
        payments: null,

        // Timestamps (MVP Required)
        createdAtISO: STATE.createdAtISO ?? now,
        updatedAtISO: now
      };
    }

    // Create Event
    document.getElementById('createForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      // Validate required fields
      const name = document.getElementById('name').value.trim();
      const startDateISO = document.getElementById('startDateISO').value;
      const venue = document.getElementById('venue').value.trim();

      if (!name) {
        SharedUtils.showToast('Event Name is required', 'warning');
        return;
      }
      if (!startDateISO) {
        SharedUtils.showToast('Event Date is required', 'warning');
        return;
      }
      if (!venue) {
        SharedUtils.showToast('Venue is required', 'warning');
        return;
      }

      overlay(true);

      try {
        console.log('[CreateEvent] Building event data...');
        // Build canonical event object per EVENT_CONTRACT.md v2.0
        const eventData = buildEventFromForm();
        // For new events, ensure no id is set (api_saveEvent will generate)
        delete eventData.id;
        delete eventData.slug;
        delete eventData.createdAtISO;
        console.log('[CreateEvent] Event data built:', eventData.name, eventData.startDateISO, eventData.venue);

        // Get the selected event template (bar_night, rec_league, etc.)
        const selectedTemplateId = document.getElementById('templateId').value || 'custom';
        console.log('[CreateEvent] Selected template:', selectedTemplateId);

        // CANONICAL API: api_saveEvent (ZEVENT-003)
        // Contract-First pattern: Admin sends full Event object, server validates and persists
        console.log('[CreateEvent] Calling api_saveEvent (canonical)...');
        const res = await NU.rpc('api_saveEvent', {
          brandId: BRAND,
          adminKey: getAdminKey(),
          event: eventData,
          scope: SCOPE,
          templateId: selectedTemplateId
        });
        console.log('[CreateEvent] API response:', res.ok ? 'success' : 'error', res.ok ? res.value?.id : res.message);

        if (!res.ok) {
          SharedUtils.showToast(`Error: ${res.message}`, 'error');
          return;
        }

        currentEventId = res.value.id;
        console.log('[CreateEvent] Showing event card for:', currentEventId);
        showEventCard(res.value);
        console.log('[CreateEvent] Event created successfully');
      } catch (err) {
        console.error('[CreateEvent] Exception during event creation:', err);
        SharedUtils.showToast(`Error creating event: ${err.message || 'Unknown error'}`, 'error');
      } finally {
        overlay(false);
      }
    });

    /**
     * Show event card with canonical event data
     * SCHEMA: /schemas/event.schema.json
     * Simplified UX: Clean summary + 4 output cards
     */
    function showEventCard(event) {
      // Update STATE for edit mode - preserve id, slug, createdAtISO
      STATE.id = event.id || null;
      STATE.slug = event.slug || null;
      STATE.createdAtISO = event.createdAtISO || null;

      // Also sync legacy currentEventId
      currentEventId = event.id || null;

      // Schema: event.links at top level
      const links = event.links || {};
      const qr = event.qr || {};

      // Set links for the 4 output cards
      setLink('lnkPublic', links.publicUrl);
      setLink('lnkDisplay', links.displayUrl);
      setLink('lnkPoster', links.posterUrl);
      // Set report link (uses sharedReportUrl or falls back to constructing it)
      const reportUrl = links.sharedReportUrl || (links.publicUrl ? links.publicUrl.replace('page=public', 'page=report') : '');
      setLink('lnkReport', reportUrl);

      // Show the event card, hide the Quick Start Guide and create form
      document.getElementById('eventCard').style.display = '';
      document.getElementById('quickStartGuide').style.display = 'none';
      document.getElementById('createCard').style.display = 'none';
      // Dashboard hidden for MVP - stats not implemented
      // document.getElementById('dashboardCard').style.display = '';

      // Format date for display
      const dateStr = event.startDateISO || '';
      const eventDate = new Date(dateStr + 'T00:00:00');
      let dateDisplay = dateStr;
      if (dateStr && !isNaN(eventDate.getTime())) {
        dateDisplay = eventDate.toLocaleDateString('en-US', {
          weekday: 'short', month: 'short', day: 'numeric', year: 'numeric'
        });
      }

      // Clean, simple event summary
      const info = `
        <p style="font-size: 1.1rem; color: var(--color-gray-700, #334155); margin: 0;">
          <strong>${NU.esc(event.name || 'Your Event')}</strong>
          <span style="color: var(--color-gray-400, #94a3b8); margin: 0 8px;">|</span>
          ${NU.esc(dateDisplay)}
          <span style="color: var(--color-gray-400, #94a3b8); margin: 0 8px;">|</span>
          ${NU.esc(event.venue || '')}
        </p>
      `;

      document.getElementById('eventInfo').innerHTML = info;

      // Five-Card Shell: Display event ID in diagnostics section
      const eventIdDisplay = document.getElementById('eventIdDisplay');
      if (eventIdDisplay) {
        eventIdDisplay.textContent = event.id || 'N/A';
      }

      // Seven-Card Shell: Show mini QR previews
      renderPublicQRPreview(links.publicUrl);
      renderPosterQRPreview(links.posterUrl);

      // Feature 2: Render SharedReport QR Code (in the Share Report card)
      renderSharedReportQR(event);

      // Feature 1: Render Sponsor Performance Links
      renderSponsorReports(event);

      // Update Happy Path checklist status based on event data
      updateChecklistStatus(event);

      // Scroll to the checklist at the top of the Seven-Card layout
      document.getElementById('happyPathChecklist').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function setLink(id, url) {
      const a = document.getElementById(id);
      a.textContent = url;
      a.href = url;
    }

    async function copy(id) {
      const url = document.getElementById(id).textContent;
      await navigator.clipboard.writeText(url);
      SharedUtils.showToast('Link copied!', 'success');
    }

    async function copyUrl(url) {
      try {
        await navigator.clipboard.writeText(url);
        SharedUtils.showToast('Link copied!', 'success');
      } catch (e) {
        // Fallback for older browsers
        const ta = document.createElement('textarea');
        ta.value = url;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        SharedUtils.showToast('Link copied!', 'success');
      }
    }

    function clearForm() {
      document.getElementById('createForm').reset();
      document.getElementById('dashboardCard').style.display = 'none';
      document.getElementById('eventCard').style.display = 'none';
      document.getElementById('signupCard').style.display = 'none';
      document.getElementById('displayCard').style.display = 'none';
      document.getElementById('formsCard').style.display = 'none';

      // Clear STATE for new event creation
      STATE.id = null;
      STATE.slug = null;
      STATE.createdAtISO = null;
      currentEventId = null;

      // Reset to default template
      selectTemplate(defaultTemplateId);

      // Show the create card
      document.getElementById('createCard').style.display = '';
    }

    // ===== Happy Path Checklist Functions =====

    // Store current event data for checklist status checks
    let currentEventData = null;

    // Scroll to a specific card section
    function scrollToCard(cardId) {
      const card = document.getElementById(cardId);
      if (!card) return;

      // If it's a collapsed mobile card, expand it first
      if (card.classList.contains('mobile-collapsed')) {
        toggleMobileCard(card);
      }

      // Smooth scroll to the card with offset for fixed header
      const headerOffset = 20;
      const elementPosition = card.getBoundingClientRect().top;
      const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

      window.scrollTo({
        top: offsetPosition,
        behavior: 'smooth'
      });

      // Brief highlight effect
      card.style.transition = 'box-shadow 0.3s ease';
      card.style.boxShadow = '0 0 0 3px rgba(37, 99, 235, 0.3)';
      setTimeout(() => {
        card.style.boxShadow = '';
      }, 1500);
    }

    // Update a single checklist item's visual state
    function setChecklistItemStatus(itemId, status, isOptional = false) {
      const item = document.getElementById(itemId);
      if (!item) return;

      const indicator = item.querySelector('.check-indicator');

      // Remove all state classes
      item.classList.remove('done', 'optional-pending');
      indicator.classList.remove('done', 'pending', 'optional');

      if (status === 'done') {
        item.classList.add('done');
        indicator.classList.add('done');
        indicator.textContent = '‚úì';
      } else if (isOptional) {
        item.classList.add('optional-pending');
        indicator.classList.add('optional');
        indicator.textContent = '~';
      } else {
        indicator.classList.add('pending');
        indicator.textContent = '';
      }
    }

    // Update all checklist items based on event data
    // Time estimates: event=2min, signup=2min, poster=1min, display=1min, public=2min, sponsors=optional
    function updateChecklistStatus(event) {
      currentEventData = event;
      const links = event.links || {};
      const data = event.data || {};
      const sponsors = event.sponsors || [];

      // Track completed count and remaining time
      let completed = 0;
      let remainingMinutes = 0;
      const total = 6;

      // Time estimates per task (minutes)
      const timeEstimates = {
        event: 2,
        signup: 2,
        poster: 1,
        display: 1,
        public: 2
      };

      // 1. Event name & date - always done if we're showing the event card
      setChecklistItemStatus('checklist-event', 'done');
      completed++;

      // 2. Signup form - done if at least one form URL is configured
      const hasFormUrl = data.registerUrl || data.checkinUrl || data.walkinUrl || data.surveyUrl;
      if (hasFormUrl) {
        setChecklistItemStatus('checklist-signup', 'done');
        completed++;
      } else {
        setChecklistItemStatus('checklist-signup', 'pending');
        remainingMinutes += timeEstimates.signup;
      }

      // 3. Poster - done if posterUrl exists (generated on event creation)
      if (links.posterUrl) {
        setChecklistItemStatus('checklist-poster', 'done');
        completed++;
      } else {
        setChecklistItemStatus('checklist-poster', 'pending');
        remainingMinutes += timeEstimates.poster;
      }

      // 4. TV Display - done if displayUrl exists
      if (links.displayUrl) {
        setChecklistItemStatus('checklist-display', 'done');
        completed++;
      } else {
        setChecklistItemStatus('checklist-display', 'pending');
        remainingMinutes += timeEstimates.display;
      }

      // 5. Public link - done if publicUrl exists
      if (links.publicUrl) {
        setChecklistItemStatus('checklist-public', 'done');
        completed++;
      } else {
        setChecklistItemStatus('checklist-public', 'pending');
        remainingMinutes += timeEstimates.public;
      }

      // 6. Sponsors - optional, done if sponsors array has items (moved to end)
      if (sponsors.length > 0) {
        setChecklistItemStatus('checklist-sponsors', 'done');
        completed++;
      } else {
        setChecklistItemStatus('checklist-sponsors', 'pending', true);
      }

      // Update progress text
      const progressEl = document.getElementById('checklistProgress');
      if (progressEl) {
        progressEl.textContent = `${completed} of ${total} done`;
      }

      // Update header with remaining time
      const headerH3 = document.querySelector('#happyPathChecklist .happy-path-header h3');
      if (headerH3) {
        if (completed >= 5) {
          headerH3.textContent = 'All Set! üéâ';
        } else if (remainingMinutes > 0) {
          headerH3.textContent = `Finish Setup (~${remainingMinutes} min left)`;
        } else {
          headerH3.textContent = 'Get Your Event Ready';
        }
      }
    }

    // Configure Sign-Up Forms
    function configureSignup() {
      document.getElementById('signupCard').style.display = '';
      loadSignupForms();
    }

    async function loadSignupForms() {
      if (!currentEventId) return;
      overlay(true);
      const res = await NU.rpc('api_get', { brandId: BRAND, scope: SCOPE, id: currentEventId });
      overlay(false);

      if (res.ok && res.value) {
        const data = res.value.data || {};
        document.getElementById('registerUrl').value = data.registerUrl || '';
        document.getElementById('checkinUrl').value = data.checkinUrl || '';
        document.getElementById('walkinUrl').value = data.walkinUrl || '';
        document.getElementById('surveyUrl').value = data.surveyUrl || '';
      }
    }

    async function saveAllSignupForms() {
      if (!currentEventId) return;

      const data = {
        registerUrl: document.getElementById('registerUrl').value.trim(),
        checkinUrl: document.getElementById('checkinUrl').value.trim(),
        walkinUrl: document.getElementById('walkinUrl').value.trim(),
        surveyUrl: document.getElementById('surveyUrl').value.trim()
      };

      overlay(true);
      // CANONICAL API: api_saveEvent via saveEventPartial (ZEVENT-003)
      // Uses load-merge-save pattern to update partial data via canonical write endpoint
      const res = await saveEventPartial(currentEventId, { data });
      overlay(false);

      if (res.ok) {
        SharedUtils.showToast('Sign-up forms saved!', 'success');
        closeSignupConfig();
        // Update checklist status with new form URLs
        if (currentEventData) {
          currentEventData.data = currentEventData.data || {};
          Object.assign(currentEventData.data, data);
          updateChecklistStatus(currentEventData);
        }
      } else {
        SharedUtils.showToast(`Error: ${res.message}`, 'error');
      }
    }

    function closeSignupConfig() {
      document.getElementById('signupCard').style.display = 'none';
    }

    // Google Forms Templates
    function openFormsTemplates() {
      document.getElementById('formsCard').style.display = '';
    }

    function closeFormsTemplates() {
      document.getElementById('formsCard').style.display = 'none';
    }

    async function createFormTemplate(templateType) {
      if (!currentEventId) {
        SharedUtils.showToast('Please select or create an event first.', 'warning');
        return;
      }

      const displayMap = {
        'check-in': 'checkin-form-display',
        'walk-in': 'walkin-form-display',
        'survey': 'survey-form-display'
      };

      const displayId = displayMap[templateType];
      if (!displayId) return;

      const displayDiv = document.getElementById(displayId);
      displayDiv.innerHTML = '<p class="muted">Creating form...</p>';

      overlay(true);

      // Get event data for context
      const eventRes = await NU.rpc('api_get', {
        brandId: BRAND,
        scope: SCOPE,
        id: currentEventId
      });

      const eventName = eventRes.ok && eventRes.value?.data?.name
        ? eventRes.value.data.name
        : 'Event';

      // Create form from template
      const formRes = await NU.rpc('api_createFormFromTemplate', {
        brandId: BRAND,
        adminKey: getAdminKey(),
        templateType,
        eventName,
        eventId: currentEventId
      });

      if (!formRes.ok) {
        overlay(false);
        displayDiv.innerHTML = `<p style="color: #ef4444;">Error: ${formRes.message}</p>`;
        return;
      }

      const { publishedUrl, editUrl, responseSheetUrl } = formRes.value;

      // Generate shortlink for the published form
      const shortlinkRes = await NU.rpc('api_generateFormShortlink', {
        brandId: BRAND,
        adminKey: getAdminKey(),
        formUrl: publishedUrl,
        formType: templateType,
        eventId: currentEventId
      });

      overlay(false);

      const shortlink = shortlinkRes.ok ? shortlinkRes.value.shortlink : publishedUrl;

      // Display form links with copy buttons
      displayDiv.innerHTML = `
        <div style="background: #f1f5f9; padding: 12px; border-radius: 4px; margin-top: 8px;">
          <div style="margin-bottom: 8px;">
            <strong>Shortlink:</strong><br>
            <input type="text" id="${templateType}-shortlink" value="${shortlink}" readonly
                   style="width: 100%; margin-top: 4px; font-size: 12px;">
            <button class="btn-secondary" onclick="copyFormLink('${templateType}-shortlink')"
                    style="margin-top: 4px; width: 100%;">
              Copy Shortlink
            </button>
          </div>
          <div style="margin-top: 12px;">
            <a href="${editUrl}" target="_blank" rel="noopener" class="btn-secondary"
               style="display: inline-block; margin-right: 8px;">
              Edit Form
            </a>
            <a href="${responseSheetUrl}" target="_blank" rel="noopener" class="btn-secondary"
               style="display: inline-block;">
              View Responses
            </a>
          </div>
          <div style="margin-top: 8px; font-size: 12px; color: #64748b;">
            Form created successfully! Share the shortlink with attendees.
          </div>
        </div>
      `;
    }

    function copyFormLink(inputId) {
      const input = document.getElementById(inputId);
      if (input) {
        input.select();
        input.setSelectionRange(0, 99999); // For mobile devices
        document.execCommand('copy');

        // Visual feedback
        const originalValue = input.value;
        input.value = 'Copied!';
        setTimeout(() => {
          input.value = originalValue;
        }, 1000);
      }
    }

    // Configure Display (V2: Sponsors hidden)
    function configureDisplay() {
      document.getElementById('displayCard').style.display = '';
      loadDisplayConfig();
    }

    async function loadDisplayConfig() {
      if (!currentEventId) return;
      overlay(true);
      const res = await NU.rpc('api_get', { brandId: BRAND, scope: SCOPE, id: currentEventId });
      overlay(false);

      if (res.ok && res.value) {
        const data = res.value.data || {};
        const display = data.display || {};
        const sponsors = data.sponsors || [];

        document.getElementById('displayMode').value = display.mode || 'public';
        toggleDisplayMode();

        if (display.urls) {
          renderUrls(display.urls);
        }

        renderSponsors(sponsors);
      }
    }

    function toggleDisplayMode() {
      const mode = document.getElementById('displayMode').value;
      document.getElementById('dynamicConfig').style.display = mode === 'dynamic' ? '' : 'none';
    }

    function renderUrls(urls) {
      const list = document.getElementById('urlList');
      list.innerHTML = '';
      urls.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = 'form-group';
        div.innerHTML = `
          <label>URL ${i + 1}</label>
          <input type="url" value="${item.url || ''}" class="url-input">
          <input type="number" value="${item.seconds || 10}" min="5" max="300" placeholder="Seconds" class="url-seconds" style="width:100px;margin-top:4px;">
        `;
        list.appendChild(div);
      });
    }

    function addUrl() {
      const list = document.getElementById('urlList');
      const div = document.createElement('div');
      div.className = 'form-group';
      div.innerHTML = `
        <label>New URL</label>
        <input type="url" placeholder="https://..." class="url-input">
        <input type="number" value="10" min="5" max="300" placeholder="Seconds" class="url-seconds" style="width:100px;margin-top:4px;">
      `;
      list.appendChild(div);
    }

    function renderSponsors(sponsors) {
      const list = document.getElementById('sponsorList');
      list.innerHTML = '';
      sponsors.forEach((sp, i) => {
        const div = document.createElement('div');
        div.className = 'event-card';
        const placements = sp.placements || {};
        div.innerHTML = `
          <h4>Sponsor ${i + 1} ${sp.isPrimary ? '<span style="background:#fef3c7;color:#92400e;padding:2px 6px;border-radius:8px;font-size:0.7rem;">PRIMARY</span>' : ''}</h4>
          <input type="text" placeholder="Name" value="${sp.name || ''}" class="sp-name" style="width:100%;margin-bottom:4px;">
          <input type="url" placeholder="URL" value="${sp.url || ''}" class="sp-url" style="width:100%;margin-bottom:4px;">
          <input type="url" placeholder="Image URL" value="${sp.img || ''}" class="sp-img" style="width:100%;margin-bottom:8px;">
          <label style="display:block;margin-bottom:8px;padding:8px;background:#fef3c7;border-radius:6px;"><input type="checkbox" class="sp-isPrimary" ${sp.isPrimary ? 'checked' : ''}> <strong>Primary Sponsor</strong> <span style="font-size:0.8em;color:#92400e;">(Bigger rendering)</span></label>
          <label><input type="checkbox" class="sp-posterTop" ${placements.posterTop ? 'checked' : ''}> Poster Top</label><br>
          <label><input type="checkbox" class="sp-tvTop" ${placements.tvTop ? 'checked' : ''}> TV Top</label><br>
          <label><input type="checkbox" class="sp-tvSide" ${placements.tvSide ? 'checked' : ''}> TV Side</label><br>
          <label><input type="checkbox" class="sp-mobileBanner" ${placements.mobileBanner ? 'checked' : ''}> Mobile Banner</label>
        `;
        list.appendChild(div);
      });
    }

    function addSponsor() {
      const list = document.getElementById('sponsorList');
      const div = document.createElement('div');
      div.className = 'event-card';
      div.innerHTML = `
        <h4>New Sponsor</h4>
        <input type="text" placeholder="Name" class="sp-name" style="width:100%;margin-bottom:4px;">
        <input type="url" placeholder="URL" class="sp-url" style="width:100%;margin-bottom:4px;">
        <input type="url" placeholder="Image URL" class="sp-img" style="width:100%;margin-bottom:8px;">
        <label style="display:block;margin-bottom:8px;padding:8px;background:#fef3c7;border-radius:6px;"><input type="checkbox" class="sp-isPrimary"> <strong>Primary Sponsor</strong> <span style="font-size:0.8em;color:#92400e;">(Bigger rendering)</span></label>
        <label><input type="checkbox" class="sp-posterTop"> Poster Top</label><br>
        <label><input type="checkbox" class="sp-tvTop"> TV Top</label><br>
        <label><input type="checkbox" class="sp-tvSide"> TV Side</label><br>
        <label><input type="checkbox" class="sp-mobileBanner"> Mobile Banner</label>
      `;
      list.appendChild(div);
    }

    async function saveDisplayConfig() {
      if (!currentEventId) return;

      const mode = document.getElementById('displayMode').value;
      const urls = [];

      if (mode === 'dynamic') {
        document.querySelectorAll('#urlList .form-group').forEach(row => {
          const url = row.querySelector('.url-input').value.trim();
          const seconds = Number(row.querySelector('.url-seconds').value || 10);
          if (url) urls.push({ url, seconds });
        });
      }

      const sponsors = [];
      document.querySelectorAll('#sponsorList .event-card').forEach(row => {
        const name = row.querySelector('.sp-name').value.trim();
        if (!name) return;
        sponsors.push({
          id: (typeof crypto !== 'undefined' && crypto.randomUUID) ? crypto.randomUUID() : `sp-${Date.now()}`,
          name,
          url: row.querySelector('.sp-url').value.trim(),
          img: row.querySelector('.sp-img').value.trim(),
          isPrimary: row.querySelector('.sp-isPrimary')?.checked || false,
          placements: {
            posterTop: row.querySelector('.sp-posterTop').checked,
            tvTop: row.querySelector('.sp-tvTop').checked,
            tvSide: row.querySelector('.sp-tvSide').checked,
            mobileBanner: row.querySelector('.sp-mobileBanner').checked
          }
        });
      });

      overlay(true);
      // CANONICAL API: api_saveEvent via saveEventPartial (ZEVENT-003)
      // Uses load-merge-save pattern to update partial data via canonical write endpoint
      const res = await saveEventPartial(currentEventId, {
        data: { display: { mode, urls }, sponsors }
      });
      overlay(false);

      if (res.ok) {
        SharedUtils.showToast('Display configuration saved!', 'success');
      } else {
        SharedUtils.showToast(`Error: ${res.message}`, 'error');
      }
    }

    function closeDisplayConfig() {
      document.getElementById('displayCard').style.display = 'none';
    }

    // Helpers
    function overlay(on) {
      document.getElementById('overlay').style.display = on ? 'flex' : 'none';
    }

    function getAdminKey() {
      const k = sessionStorage.getItem('ADMIN_KEY:' + BRAND) || prompt('Admin key for ' + BRAND);
      if (k) sessionStorage.setItem('ADMIN_KEY:' + BRAND, k);
      return k || '';
    }

    /**
     * CANONICAL WRITE API HELPER (ZEVENT-003)
     * Load-Merge-Save pattern using only api_saveEvent (canonical write endpoint).
     *
     * This helper replaces direct api_updateEventData calls to ensure Admin
     * uses only the canonical write API per the Event Contract.
     *
     * @param {string} eventId - Event ID to update
     * @param {Object} partialData - Partial data to merge into event
     * @returns {Object} Result from api_saveEvent { ok, value, message }
     */
    async function saveEventPartial(eventId, partialData) {
      // Step 1: Load current event via api_get
      const getRes = await NU.rpc('api_get', {
        brandId: BRAND,
        scope: SCOPE,
        id: eventId
      });

      if (!getRes.ok) {
        return { ok: false, message: `Failed to load event: ${getRes.message}` };
      }

      // Step 2: Merge partial data into the full event object
      const currentEvent = getRes.value;
      const mergedEvent = deepMerge_(currentEvent, partialData);

      // Step 3: Save via canonical api_saveEvent
      const saveRes = await NU.rpc('api_saveEvent', {
        brandId: BRAND,
        adminKey: getAdminKey(),
        event: mergedEvent,
        scope: SCOPE
      });

      return saveRes;
    }

    /**
     * Deep merge helper for event objects.
     * Merges source into target, handling nested objects.
     * Arrays are replaced, not merged.
     */
    function deepMerge_(target, source) {
      const result = { ...target };
      for (const key of Object.keys(source)) {
        if (source[key] !== null && typeof source[key] === 'object' && !Array.isArray(source[key])) {
          // Nested object - recurse
          result[key] = deepMerge_(result[key] || {}, source[key]);
        } else {
          // Primitive, array, or null - replace
          result[key] = source[key];
        }
      }
      // Update timestamp on every save
      result.updatedAtISO = new Date().toISOString();
      return result;
    }

    // === MOBILE-FIRST CARD COLLAPSE ===
    // Collapse non-essential cards on mobile for better UX
    const MOBILE_BREAKPOINT = 640;

    /**
     * Toggle a mobile-collapsible card
     * @param {HTMLElement} card - The card element to toggle
     */
    function toggleMobileCard(card) {
      if (!card) return;
      card.classList.toggle('mobile-collapsed');
      const toggle = card.querySelector('.card-collapse-toggle');
      if (toggle) {
        const hint = toggle.querySelector('.collapse-hint');
        if (hint) {
          hint.textContent = card.classList.contains('mobile-collapsed') ? 'Tap to expand' : 'Tap to collapse';
        }
      }
    }

    /**
     * Initialize mobile card collapse on page load
     * Collapses cards marked with data-mobile-collapse="true" on mobile viewports
     */
    function initMobileCardCollapse() {
      if (window.innerWidth > MOBILE_BREAKPOINT) return;

      document.querySelectorAll('[data-mobile-collapse="true"]').forEach(card => {
        card.classList.add('mobile-collapsed');
      });
    }

    /**
     * Re-check mobile collapse on resize (e.g., orientation change)
     */
    function handleMobileResize() {
      const isMobile = window.innerWidth <= MOBILE_BREAKPOINT;
      document.querySelectorAll('[data-mobile-collapse="true"]').forEach(card => {
        if (isMobile && !card.classList.contains('mobile-collapsed')) {
          // Don't auto-collapse if user has interacted
          // card.classList.add('mobile-collapsed');
        } else if (!isMobile) {
          // Expand all on desktop
          card.classList.remove('mobile-collapsed');
        }
      });
    }

    // Initialize on DOM ready
    document.addEventListener('DOMContentLoaded', initMobileCardCollapse);
    // Handle orientation changes
    window.addEventListener('resize', debounce(handleMobileResize, 250));

    /**
     * Simple debounce helper
     */
    function debounce(fn, delay) {
      let timer;
      return function(...args) {
        clearTimeout(timer);
        timer = setTimeout(() => fn.apply(this, args), delay);
      };
    }

    // === SPONSOR PERFORMANCE LINKS (Feature 1) ===
    // Generate sponsor-specific report URLs with ?page=report&sponsor=true&sponsorId=xxxx
    let currentSharedReportUrl = '';

    /**
     * Build sponsor report URL using window origin + path
     * URL format: ?page=report&sponsor=true&sponsorId=<SPONSOR_ID>
     * @param {string} sponsorId - The sponsor ID to include in the URL
     * @returns {string} - Complete sponsor report URL
     */
    function buildSponsorReportUrl(sponsorId) {
      const base = window.location.origin + window.location.pathname;
      return `${base}?page=report&sponsor=true&sponsorId=${encodeURIComponent(sponsorId)}`;
    }

    /**
     * Get placement badge HTML for a sponsor
     * @param {string} placement - Placement value (public, display, poster, tv-banner)
     * @returns {string} - HTML badge element
     */
    function getSponsorPlacementBadge(placement) {
      const badges = {
        'public': '<span style="background:#dbeafe;color:#1e40af;padding:2px 6px;border-radius:8px;font-size:0.65rem;" title="Visible on Public page">Public</span>',
        'display': '<span style="background:#dcfce7;color:#166534;padding:2px 6px;border-radius:8px;font-size:0.65rem;" title="Visible on Display screen">Display</span>',
        'poster': '<span style="background:#fef3c7;color:#92400e;padding:2px 6px;border-radius:8px;font-size:0.65rem;" title="Visible on Poster">Poster</span>',
        'tv-banner': '<span style="background:#f3e8ff;color:#7e22ce;padding:2px 6px;border-radius:8px;font-size:0.65rem;" title="Visible in TV banner rotation">TV Banner</span>'
      };
      return badges[placement] || '<span style="background:#e2e8f0;color:#475569;padding:2px 6px;border-radius:8px;font-size:0.65rem;">Unknown</span>';
    }

    /**
     * Render sponsor performance links in Admin
     * Shows Open/Copy controls for each sponsor tied to the event
     * @param {Object} eventObj - Event object with sponsors[] array
     */
    function renderSponsorReports(eventObj) {
      const sponsors = eventObj.sponsors || [];
      const container = document.getElementById('sponsorReportsList');
      const section = document.getElementById('sponsorPerformanceCard');
      const placementGuide = document.getElementById('sponsorPlacementGuide');
      const previewLinksContainer = document.getElementById('sponsorPreviewLinks');

      // Always show section (for custom sponsor ID entry)
      section.style.display = '';

      // Show placement guide and preview links if we have sponsors or event links
      const links = eventObj.links || {};
      if (sponsors.length || links.publicUrl) {
        placementGuide.style.display = '';

        // Build preview links
        const previewLinks = [];
        if (links.publicUrl) {
          previewLinks.push('<a href="' + NU.esc(links.publicUrl) + '" target="_blank" rel="noopener" style="background:#dbeafe;color:#1e40af;padding:4px 10px;border-radius:12px;font-size:0.7rem;text-decoration:none;display:inline-flex;align-items:center;gap:4px;" title="Preview Public page"><span style="font-size:0.8rem;">üì±</span> Public</a>');
        }
        if (links.displayUrl) {
          previewLinks.push('<a href="' + NU.esc(links.displayUrl) + '" target="_blank" rel="noopener" style="background:#dcfce7;color:#166534;padding:4px 10px;border-radius:12px;font-size:0.7rem;text-decoration:none;display:inline-flex;align-items:center;gap:4px;" title="Preview Display screen"><span style="font-size:0.8rem;">üì∫</span> Display</a>');
        }
        if (links.posterUrl) {
          previewLinks.push('<a href="' + NU.esc(links.posterUrl) + '" target="_blank" rel="noopener" style="background:#fef3c7;color:#92400e;padding:4px 10px;border-radius:12px;font-size:0.7rem;text-decoration:none;display:inline-flex;align-items:center;gap:4px;" title="Preview Poster"><span style="font-size:0.8rem;">üñºÔ∏è</span> Poster</a>');
        }
        const reportUrl = links.sharedReportUrl || (links.publicUrl ? links.publicUrl.replace('page=public', 'page=report') : '');
        if (reportUrl) {
          previewLinks.push('<a href="' + NU.esc(reportUrl) + '" target="_blank" rel="noopener" style="background:#fce7f3;color:#be185d;padding:4px 10px;border-radius:12px;font-size:0.7rem;text-decoration:none;display:inline-flex;align-items:center;gap:4px;" title="Preview Shared Report"><span style="font-size:0.8rem;">üìä</span> Report</a>');
        }
        previewLinksContainer.innerHTML = previewLinks.join('');
      } else {
        placementGuide.style.display = 'none';
      }

      if (!sponsors.length) {
        container.innerHTML = '<p class="muted" style="grid-column:1/-1;">No sponsors configured. Use the form below to generate custom sponsor links.</p>';
        return;
      }

      // Render sponsor performance table with Placement + Actions + QR
      container.innerHTML = `
        <table class="sponsor-report-table" style="width:100%;border-collapse:collapse;font-size:0.875rem;">
          <thead style="background:var(--color-gray-100,#f1f5f9);">
            <tr>
              <th style="text-align:left;padding:0.75rem 1rem;font-weight:600;color:var(--color-gray-600,#475569);font-size:0.75rem;text-transform:uppercase;">Sponsor</th>
              <th style="text-align:center;padding:0.75rem 0.5rem;font-weight:600;color:var(--color-gray-600,#475569);font-size:0.75rem;text-transform:uppercase;">Visible On</th>
              <th style="text-align:center;padding:0.75rem 0.5rem;font-weight:600;color:var(--color-gray-600,#475569);font-size:0.75rem;text-transform:uppercase;">Actions</th>
              <th style="text-align:center;padding:0.75rem 0.5rem;font-weight:600;color:var(--color-gray-600,#475569);font-size:0.75rem;text-transform:uppercase;">QR</th>
            </tr>
          </thead>
          <tbody>
            ${sponsors.map(sp => {
              const sponsorUrl = buildSponsorReportUrl(sp.id);
              const escapedUrl = NU.esc(sponsorUrl);
              const escapedId = NU.esc(sp.id);
              const primaryBadge = sp.isPrimary ? '<span style="background:#fef3c7;color:#92400e;padding:2px 6px;border-radius:8px;font-size:0.65rem;margin-left:6px;">PRIMARY</span>' : '';
              const placementBadge = getSponsorPlacementBadge(sp.placement);
              return '<tr style="border-bottom:1px solid var(--color-gray-100,#f1f5f9);" data-sponsor-id="' + escapedId + '">' +
                '<td style="padding:0.75rem 1rem;">' +
                  '<strong>' + NU.esc(sp.name || sp.id) + '</strong>' + primaryBadge +
                  '<div style="font-size:0.7rem;color:#94a3b8;margin-top:4px;word-break:break-all;">' + escapedUrl.slice(0,60) + '...</div>' +
                '</td>' +
                '<td style="padding:0.75rem 0.5rem;text-align:center;">' + placementBadge + '</td>' +
                '<td style="padding:0.75rem 0.5rem;text-align:center;white-space:nowrap;">' +
                  '<button class="btn-secondary sponsor-open-btn" data-sponsor-url="' + escapedUrl + '" style="padding:6px 10px;font-size:0.75rem;margin-right:6px;">Open Report</button>' +
                  '<button class="btn-secondary sponsor-copy-btn" data-sponsor-url="' + escapedUrl + '" style="padding:6px 10px;font-size:0.75rem;">Copy Link</button>' +
                '</td>' +
                '<td style="padding:0.75rem 0.5rem;text-align:center;">' +
                  '<button class="btn-secondary sponsor-qr-btn" data-sponsor-id="' + escapedId + '" data-sponsor-name="' + NU.esc(sp.name || sp.id) + '" style="padding:6px 10px;font-size:0.75rem;">Show QR</button>' +
                '</td>' +
              '</tr>';
            }).join('')}
          </tbody>
        </table>
      `;

      // Wire up button event handlers
      wireSponsorReportButtons(container);
    }

    /**
     * Wire click handlers for sponsor report buttons within a container
     * Attaches handlers for Open (window.open), Copy (clipboard + toast), and QR buttons
     * @param {HTMLElement} root - Container element to search for buttons
     */
    function wireSponsorReportButtons(root) {
      if (!root) return;

      // Wire Open buttons - use window.open() per story spec
      root.querySelectorAll('.sponsor-open-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const url = this.dataset.sponsorUrl;
          if (!url) return;
          window.open(url, '_blank', 'noopener');
        });
      });

      // Wire Copy buttons
      root.querySelectorAll('.sponsor-copy-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const url = this.dataset.sponsorUrl;
          if (!url) return;
          navigator.clipboard.writeText(url).then(() => {
            SharedUtils.showToast('Sponsor report link copied!', 'success');
          }).catch(() => {
            // Fallback for older browsers
            const ta = document.createElement('textarea');
            ta.value = url;
            ta.style.position = 'fixed';
            ta.style.left = '-9999px';
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            SharedUtils.showToast('Sponsor report link copied!', 'success');
          });
        });
      });

      // Wire QR buttons
      root.querySelectorAll('.sponsor-qr-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const sponsorId = this.dataset.sponsorId;
          const sponsorName = this.dataset.sponsorName;
          if (!sponsorId) return;
          showSponsorQrCode(sponsorId, sponsorName);
        });
      });
    }

    /**
     * Fetch and display QR code for a sponsor's report
     * @param {string} sponsorId - The sponsor ID
     * @param {string} sponsorName - The sponsor name for display
     */
    async function showSponsorQrCode(sponsorId, sponsorName) {
      // Show loading state
      showSponsorQrModal(sponsorName, null, true);

      try {
        const payload = {
          action: 'getSponsorReportQr',
          sponsorId: sponsorId,
          brandId: currentBrandId,
          adminKey: currentAdminKey
        };

        const response = await fetch(execUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const result = await response.json();

        if (!result.ok) {
          showSponsorQrModal(sponsorName, null, false, result.error || 'Failed to generate QR code');
          return;
        }

        // Respect invariant: no QR for unverified URLs
        if (!result.value.verified || !result.value.qrB64) {
          showSponsorQrModal(sponsorName, null, false, 'QR code unavailable - URL not verified');
          return;
        }

        // Show QR code
        showSponsorQrModal(sponsorName, result.value.qrB64, false, null, result.value.url);

      } catch (e) {
        console.error('Failed to fetch sponsor QR:', e);
        showSponsorQrModal(sponsorName, null, false, 'Network error - please try again');
      }
    }

    /**
     * Display modal with sponsor QR code
     * @param {string} sponsorName - Sponsor name for title
     * @param {string|null} qrB64 - Base64 encoded QR image (null if loading/error)
     * @param {boolean} loading - Show loading spinner
     * @param {string|null} error - Error message to display
     * @param {string|null} url - The URL the QR encodes (for display)
     */
    function showSponsorQrModal(sponsorName, qrB64, loading, error, url) {
      // Remove existing modal if any
      const existing = document.getElementById('sponsorQrModal');
      if (existing) existing.remove();

      let content = '';
      if (loading) {
        content = '<div style="padding:40px;text-align:center;"><span class="spinner"></span><p style="margin-top:12px;color:#64748b;">Loading QR code...</p></div>';
      } else if (error) {
        content = '<div style="padding:40px;text-align:center;color:#ef4444;"><p>' + NU.esc(error) + '</p></div>';
      } else if (qrB64) {
        content = `
          <div style="text-align:center;padding:20px;">
            <img src="data:image/png;base64,${qrB64}" alt="Sponsor report QR" style="max-width:200px;height:auto;border:1px solid #e2e8f0;border-radius:8px;">
            <p style="margin-top:12px;font-size:0.75rem;color:#64748b;word-break:break-all;">${NU.esc(url || '')}</p>
            <p style="margin-top:8px;font-size:0.7rem;color:#94a3b8;">Scan to view sponsor analytics</p>
          </div>
        `;
      }

      const modal = document.createElement('div');
      modal.id = 'sponsorQrModal';
      modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;';
      modal.innerHTML = `
        <div style="background:white;border-radius:12px;max-width:320px;width:90%;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25);">
          <div style="padding:16px 20px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;">
            <h3 style="margin:0;font-size:1rem;font-weight:600;">${NU.esc(sponsorName)} QR</h3>
            <button onclick="closeSponsorQrModal()" style="background:none;border:none;cursor:pointer;font-size:1.25rem;color:#64748b;padding:0;line-height:1;">&times;</button>
          </div>
          ${content}
        </div>
      `;

      // Close on backdrop click
      modal.addEventListener('click', function(e) {
        if (e.target === modal) closeSponsorQrModal();
      });

      document.body.appendChild(modal);
    }

    /**
     * Close the sponsor QR modal
     */
    function closeSponsorQrModal() {
      const modal = document.getElementById('sponsorQrModal');
      if (modal) modal.remove();
    }

    /**
     * Build base SharedReport URL for QR code
     * @param {Object} event - Event object (unused, kept for API compat)
     * @returns {string} - Base SharedReport URL
     */
    function buildSharedReportUrl(event) {
      const base = window.location.origin + window.location.pathname;
      return `${base}?page=report`;
    }

    /**
     * Generate custom sponsor report link from manual ID input
     */
    function generateSponsorReportLink() {
      const sponsorId = document.getElementById('customSponsorId').value.trim();
      if (!sponsorId) {
        SharedUtils.showToast('Please enter a Sponsor ID', 'warning');
        return;
      }

      const sponsorUrl = buildSponsorReportUrl(sponsorId);
      document.getElementById('customSponsorLinkField').value = sponsorUrl;
      document.getElementById('customSponsorLinkOutput').style.display = '';
    }

    /**
     * Copy custom sponsor link to clipboard
     */
    function copyCustomSponsorLink() {
      const url = document.getElementById('customSponsorLinkField').value;
      navigator.clipboard.writeText(url).then(() => {
        SharedUtils.showToast('Sponsor report link copied!', 'success');
      }).catch(() => {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = url;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        SharedUtils.showToast('Sponsor report link copied!', 'success');
      });
    }

    // === SHAREDREPORT QR CODE (Feature 2) ===
    function renderSharedReportQR(event) {
      const container = document.getElementById('qrSharedReport');
      const reportUrl = buildSharedReportUrl(event);
      currentSharedReportUrl = reportUrl;

      // Use Google Charts QR API (same as existing QR generation)
      const qrApiUrl = `https://chart.googleapis.com/chart?cht=qr&chs=120x120&chl=${encodeURIComponent(reportUrl)}`;
      container.innerHTML = `<img src="${qrApiUrl}" alt="SharedReport QR" style="width:120px;height:120px;border:1px solid #e2e8f0;border-radius:8px;">`;
    }

    function copyQRSharedReport() {
      const url = currentSharedReportUrl || buildSharedReportUrl({});
      navigator.clipboard.writeText(url).then(() => {
        SharedUtils.showToast('SharedReport link copied!', 'success');
      });
    }

    // === SEVEN-CARD SHELL QR FUNCTIONS ===

    /**
     * Render a mini QR preview in the Public Page card
     * @param {string} url - The public page URL
     */
    function renderPublicQRPreview(url) {
      const container = document.getElementById('qrPublicPreview');
      if (!container || !url) return;

      const qrApiUrl = `https://chart.googleapis.com/chart?cht=qr&chs=60x60&chl=${encodeURIComponent(url)}`;
      container.innerHTML = `<img src="${qrApiUrl}" alt="QR" style="width:60px;height:60px;border-radius:4px;opacity:0.8;">`;
    }

    /**
     * Render a mini QR preview in the Poster card
     * @param {string} url - The poster page URL
     */
    function renderPosterQRPreview(url) {
      const container = document.getElementById('qrPosterPreview');
      if (!container || !url) return;

      const qrApiUrl = `https://chart.googleapis.com/chart?cht=qr&chs=60x60&chl=${encodeURIComponent(url)}`;
      container.innerHTML = `<img src="${qrApiUrl}" alt="QR" style="width:60px;height:60px;border-radius:4px;opacity:0.8;">`;
    }

    /**
     * Show full-size Poster QR code in a modal
     */
    function showPosterQR() {
      const posterLink = document.getElementById('lnkPoster');
      const url = posterLink ? posterLink.href : '';
      if (!url) {
        SharedUtils.showToast('No poster URL available', 'warning');
        return;
      }

      // Remove existing modal if any
      const existing = document.getElementById('posterQrModal');
      if (existing) existing.remove();

      const qrApiUrl = `https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=${encodeURIComponent(url)}`;

      const modal = document.createElement('div');
      modal.id = 'posterQrModal';
      modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;';
      modal.innerHTML = `
        <div style="background:white;border-radius:16px;max-width:340px;width:90%;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25);overflow:hidden;">
          <div style="padding:20px 24px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
            <h3 style="margin:0;font-size:1.1rem;font-weight:600;color:#92400e;">Poster QR Code</h3>
            <button onclick="closePosterQrModal()" style="background:none;border:none;cursor:pointer;font-size:1.5rem;color:#92400e;padding:0;line-height:1;">&times;</button>
          </div>
          <div style="padding:24px;text-align:center;">
            <img src="${qrApiUrl}" alt="Poster QR code" style="width:200px;height:200px;border:1px solid #e2e8f0;border-radius:12px;">
            <p style="margin:16px 0 8px 0;font-size:0.85rem;color:#64748b;">Scan to view the poster page</p>
            <p style="margin:0;font-size:0.75rem;color:#94a3b8;word-break:break-all;font-family:monospace;">${NU.esc(url)}</p>
          </div>
          <div style="padding:16px 24px;background:#f8fafc;border-top:1px solid #e2e8f0;display:flex;gap:8px;justify-content:center;">
            <button class="btn-primary" onclick="copy('lnkPoster'); closePosterQrModal();" style="background:#d97706;">Copy Link</button>
            <button class="btn-secondary" onclick="closePosterQrModal()">Close</button>
          </div>
        </div>
      `;

      // Close on backdrop click
      modal.addEventListener('click', function(e) {
        if (e.target === modal) closePosterQrModal();
      });

      document.body.appendChild(modal);
    }

    /**
     * Close the poster QR modal
     */
    function closePosterQrModal() {
      const modal = document.getElementById('posterQrModal');
      if (modal) modal.remove();
    }

    /**
     * Show full-size Public Page QR code in a modal
     */
    function showPublicQR() {
      const publicLink = document.getElementById('lnkPublic');
      const url = publicLink ? publicLink.href : '';
      if (!url) {
        SharedUtils.showToast('No public page URL available', 'warning');
        return;
      }

      // Remove existing modal if any
      const existing = document.getElementById('publicQrModal');
      if (existing) existing.remove();

      const qrApiUrl = `https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=${encodeURIComponent(url)}`;

      const modal = document.createElement('div');
      modal.id = 'publicQrModal';
      modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;';
      modal.innerHTML = `
        <div style="background:white;border-radius:16px;max-width:340px;width:90%;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25);overflow:hidden;">
          <div style="padding:20px 24px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;">
            <h3 style="margin:0;font-size:1.1rem;font-weight:600;color:#1e293b;">Public Page QR Code</h3>
            <button onclick="closePublicQrModal()" style="background:none;border:none;cursor:pointer;font-size:1.5rem;color:#64748b;padding:0;line-height:1;">&times;</button>
          </div>
          <div style="padding:24px;text-align:center;">
            <img src="${qrApiUrl}" alt="Public page QR code" style="width:200px;height:200px;border:1px solid #e2e8f0;border-radius:12px;">
            <p style="margin:16px 0 8px 0;font-size:0.85rem;color:#64748b;">Scan to view your event page</p>
            <p style="margin:0;font-size:0.75rem;color:#94a3b8;word-break:break-all;font-family:monospace;">${NU.esc(url)}</p>
          </div>
          <div style="padding:16px 24px;background:#f8fafc;border-top:1px solid #e2e8f0;display:flex;gap:8px;justify-content:center;">
            <button class="btn-primary" onclick="copy('lnkPublic'); closePublicQrModal();" style="background:#16a34a;">Copy Link</button>
            <button class="btn-secondary" onclick="closePublicQrModal()">Close</button>
          </div>
        </div>
      `;

      // Close on backdrop click
      modal.addEventListener('click', function(e) {
        if (e.target === modal) closePublicQrModal();
      });

      document.body.appendChild(modal);
    }

    /**
     * Close the public QR modal
     */
    function closePublicQrModal() {
      const modal = document.getElementById('publicQrModal');
      if (modal) modal.remove();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // S08: CREATE & LAUNCH WIZARD - Guided "10-Minute Event" Flow
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // Wizard State
    const WIZARD = {
      currentStep: 1,
      totalSteps: 5,
      event: null,
      links: {},
      selectedTemplate: 'bar_night',
      signupOption: 'none',
      signupUrl: ''
    };

    /**
     * Initialize wizard when page loads
     */
    function initWizard() {
      // Set default date to today
      const today = new Date().toISOString().split('T')[0];
      const dateInput = document.getElementById('wizardEventDate');
      if (dateInput) dateInput.value = today;

      // Add input listeners for validation
      const nameInput = document.getElementById('wizardEventName');
      const venueInput = document.getElementById('wizardEventVenue');

      [nameInput, dateInput, venueInput].forEach(input => {
        if (input) {
          input.addEventListener('input', validateWizardStep1);
          input.addEventListener('change', validateWizardStep1);
        }
      });

      // Initial validation
      validateWizardStep1();

      // Load templates for wizard
      loadWizardTemplates();
    }

    /**
     * Load templates into wizard picker
     */
    async function loadWizardTemplates() {
      try {
        const res = await NU.rpc('api_getEventTemplates', { brandId: BRAND });
        if (res.ok && res.value) {
          const templates = res.value.items || [];
          renderWizardTemplatePicker(templates, res.value.defaultTemplateId || 'bar_night');
        }
      } catch (e) {
        console.error('[Wizard] Failed to load templates:', e);
        document.getElementById('wizardTemplatePicker').innerHTML =
          '<p class="muted">Could not load templates. Using default.</p>';
      }
    }

    /**
     * Render templates in wizard picker
     */
    function renderWizardTemplatePicker(templates, defaultId) {
      const picker = document.getElementById('wizardTemplatePicker');
      if (!templates.length) {
        picker.innerHTML = '<p class="muted">No templates available.</p>';
        return;
      }

      // Group templates by group for display
      picker.innerHTML = templates.map(t => `
        <div class="wizard-template-card ${t.id === defaultId ? 'selected' : ''}"
             data-template-id="${NU.esc(t.id)}"
             onclick="selectWizardTemplate('${NU.esc(t.id)}')">
          <div class="template-icon">${t.icon || 'üìã'}</div>
          <div class="template-name">${NU.esc(t.label || t.id)}</div>
          <div class="template-desc">${NU.esc(t.description || '')}</div>
        </div>
      `).join('');

      // Set default selection
      WIZARD.selectedTemplate = defaultId;
      document.getElementById('wizardTemplateId').value = defaultId;
    }

    /**
     * Select a template in wizard
     */
    function selectWizardTemplate(templateId) {
      WIZARD.selectedTemplate = templateId;
      document.getElementById('wizardTemplateId').value = templateId;

      // Update visual selection
      document.querySelectorAll('#wizardTemplatePicker .wizard-template-card').forEach(card => {
        card.classList.toggle('selected', card.dataset.templateId === templateId);
      });

      // Enable next button
      updateWizardNavButtons();
    }

    /**
     * Validate Step 1 inputs
     */
    function validateWizardStep1() {
      const name = document.getElementById('wizardEventName')?.value.trim();
      const date = document.getElementById('wizardEventDate')?.value;
      const venue = document.getElementById('wizardEventVenue')?.value.trim();

      const isValid = name && date && venue;
      const nextBtn = document.getElementById('wizardNextBtn');
      if (nextBtn) nextBtn.disabled = !isValid;

      return isValid;
    }

    /**
     * Select sign-up option in wizard
     */
    function selectWizardSignupOption(option) {
      WIZARD.signupOption = option;

      // Update visual selection
      document.querySelectorAll('.wizard-signup-option').forEach(opt => {
        opt.classList.toggle('selected', opt.dataset.option === option);
      });

      // Show/hide additional inputs
      document.getElementById('wizardExistingFormInput').style.display =
        option === 'existing' ? '' : 'none';
      document.getElementById('wizardCreateFormStatus').style.display =
        option === 'create' ? '' : 'none';

      // Update nav buttons
      updateWizardNavButtons();
    }

    /**
     * Navigate to next wizard step
     */
    async function wizardNextStep() {
      const currentStep = WIZARD.currentStep;

      // Step-specific actions before advancing
      if (currentStep === 1) {
        // Validate Step 1
        if (!validateWizardStep1()) {
          SharedUtils.showToast('Please fill in all required fields', 'warning');
          return;
        }
      } else if (currentStep === 2) {
        // Step 2 ‚Üí 3: Template selected, nothing extra needed
      } else if (currentStep === 3) {
        // Step 3 ‚Üí 4: Create event and get links
        const success = await createWizardEvent();
        if (!success) return;
      }

      // Advance step
      if (currentStep < WIZARD.totalSteps) {
        setWizardStep(currentStep + 1);
      }
    }

    /**
     * Navigate to previous wizard step
     */
    function wizardPrevStep() {
      if (WIZARD.currentStep > 1) {
        setWizardStep(WIZARD.currentStep - 1);
      }
    }

    /**
     * Skip current step (for optional steps)
     */
    function wizardSkipStep() {
      // Only Step 3 (Sign-ups) is skippable
      if (WIZARD.currentStep === 3) {
        WIZARD.signupOption = 'none';
        wizardNextStep();
      }
    }

    /**
     * Go directly to a step (if allowed)
     */
    function wizardGoToStep(stepNum) {
      // Can only go to completed steps or current step
      const stepEl = document.querySelector(`.wizard-progress-step[data-step="${stepNum}"]`);
      if (!stepEl || stepEl.classList.contains('disabled')) return;

      setWizardStep(stepNum);
    }

    /**
     * Set wizard to a specific step
     */
    function setWizardStep(stepNum) {
      WIZARD.currentStep = stepNum;

      // Update step content visibility
      document.querySelectorAll('.wizard-step').forEach((step, idx) => {
        step.classList.toggle('active', idx + 1 === stepNum);
      });

      // Update progress indicators
      document.querySelectorAll('.wizard-progress-step').forEach(step => {
        const num = parseInt(step.dataset.step);
        step.classList.remove('active', 'completed', 'disabled');
        if (num === stepNum) {
          step.classList.add('active');
        } else if (num < stepNum) {
          step.classList.add('completed');
        } else {
          step.classList.add('disabled');
        }
      });

      // Update navigation buttons
      updateWizardNavButtons();

      // Scroll to top of wizard
      document.getElementById('launchWizard').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    /**
     * Update wizard navigation buttons based on current step
     */
    function updateWizardNavButtons() {
      const backBtn = document.getElementById('wizardBackBtn');
      const skipBtn = document.getElementById('wizardSkipBtn');
      const nextBtn = document.getElementById('wizardNextBtn');

      // Back button: visible for steps 2+
      backBtn.style.display = WIZARD.currentStep > 1 ? '' : 'none';

      // Skip button: only on Step 3 (Sign-ups)
      skipBtn.style.display = WIZARD.currentStep === 3 ? '' : 'none';

      // Next button: varies by step
      if (WIZARD.currentStep === 1) {
        nextBtn.textContent = 'Next ‚Üí';
        nextBtn.className = 'btn-wizard-next';
        nextBtn.disabled = !validateWizardStep1();
      } else if (WIZARD.currentStep === 2) {
        nextBtn.textContent = 'Next ‚Üí';
        nextBtn.className = 'btn-wizard-next';
        nextBtn.disabled = false;
      } else if (WIZARD.currentStep === 3) {
        nextBtn.textContent = 'Create Event ‚Üí';
        nextBtn.className = 'btn-wizard-next btn-wizard-launch';
        nextBtn.disabled = false;
      } else if (WIZARD.currentStep === 4) {
        nextBtn.textContent = 'Continue to Checklist ‚Üí';
        nextBtn.className = 'btn-wizard-next';
        nextBtn.disabled = false;
      } else if (WIZARD.currentStep === 5) {
        // Hide Next button on final step (use "Done" button instead)
        nextBtn.style.display = 'none';
        return;
      }

      nextBtn.style.display = '';
    }

    /**
     * Create event via wizard (Step 3 ‚Üí 4 transition)
     * Uses existing api_saveEvent RPC
     */
    async function createWizardEvent() {
      overlay(true);

      try {
        // Gather form data
        const name = document.getElementById('wizardEventName').value.trim();
        const startDateISO = document.getElementById('wizardEventDate').value;
        const venue = document.getElementById('wizardEventVenue').value.trim();
        const templateId = WIZARD.selectedTemplate;

        // Get signup URL if provided
        let signupUrl = '';
        if (WIZARD.signupOption === 'existing') {
          signupUrl = document.getElementById('wizardSignupUrl')?.value.trim() || '';
        }

        // Build event object (minimal required fields)
        const eventId = generateId();
        const slug = slugify(name);

        const event = {
          id: eventId,
          slug: slug,
          name: name,
          startDateISO: startDateISO,
          venue: venue,
          ctas: {
            primary: {
              label: 'Sign Up',
              url: signupUrl
            }
          },
          settings: {
            showSchedule: false,
            showStandings: false,
            showBracket: false,
            showVideo: true,
            showMap: true,
            showGallery: true,
            showSponsors: true,
            showSponsorBanner: true,
            showSponsorStrip: true,
            showLeagueStrip: true,
            showQRSection: true
          }
        };

        // Add signup URL if provided
        if (signupUrl) {
          event.registerUrl = signupUrl;
        }

        // Get admin key
        const adminKey = getAdminKey();
        if (!adminKey) {
          SharedUtils.showToast('Admin key required', 'error');
          return false;
        }

        // Call api_saveEvent (existing RPC)
        console.log('[Wizard] Creating event:', eventId);
        const res = await NU.rpc('api_saveEvent', {
          brandId: BRAND,
          adminKey: adminKey,
          event: event,
          scope: SCOPE,
          templateId: templateId
        });

        if (!res.ok) {
          SharedUtils.showToast(`Error: ${res.message}`, 'error');
          return false;
        }

        // Store created event data
        WIZARD.event = res.value;
        WIZARD.links = res.value.links || {};

        // If user wanted a form created, do that now
        if (WIZARD.signupOption === 'create') {
          await createWizardSignupForm(eventId, name);
        }

        // Populate Step 4 (Links) with generated URLs
        populateWizardLinks();

        // Update Step 5 summary
        updateWizardSummary();

        console.log('[Wizard] Event created successfully:', eventId);
        SharedUtils.showToast('Event created!', 'success');

        return true;
      } catch (err) {
        console.error('[Wizard] Error creating event:', err);
        SharedUtils.showToast(`Error: ${err.message}`, 'error');
        return false;
      } finally {
        overlay(false);
      }
    }

    /**
     * Create a signup form via existing api_createFormFromTemplate RPC
     */
    async function createWizardSignupForm(eventId, eventName) {
      try {
        const adminKey = getAdminKey();
        const res = await NU.rpc('api_createFormFromTemplate', {
          brandId: BRAND,
          adminKey: adminKey,
          templateType: 'registration',
          eventName: eventName,
          eventId: eventId
        });

        if (res.ok && res.publishedUrl) {
          WIZARD.signupUrl = res.publishedUrl;
          // Update the event with the form URL
          await NU.rpc('api_saveEvent', {
            brandId: BRAND,
            adminKey: adminKey,
            event: {
              id: eventId,
              registerUrl: res.publishedUrl,
              ctas: { primary: { label: 'Sign Up', url: res.publishedUrl } }
            },
            scope: SCOPE
          });
          console.log('[Wizard] Created signup form:', res.publishedUrl);
        }
      } catch (e) {
        console.warn('[Wizard] Could not create signup form:', e);
        // Non-fatal - continue without form
      }
    }

    /**
     * Populate Step 4 links display
     */
    function populateWizardLinks() {
      const links = WIZARD.links;

      // Generate QR codes for each link
      const qrSize = 80;
      const surfaces = [
        { id: 'public', url: links.publicUrl, container: 'wizardQrPublic' },
        { id: 'poster', url: links.posterUrl, container: 'wizardQrPoster' },
        { id: 'display', url: links.displayUrl, container: 'wizardQrDisplay' },
        { id: 'report', url: links.sharedReportUrl || buildSharedReportUrlFromEvent(WIZARD.event), container: 'wizardQrReport' }
      ];

      surfaces.forEach(({ url, container }) => {
        const el = document.getElementById(container);
        if (el && url) {
          const qrUrl = `https://chart.googleapis.com/chart?cht=qr&chs=${qrSize}x${qrSize}&chl=${encodeURIComponent(url)}`;
          el.innerHTML = `<img src="${qrUrl}" alt="QR Code" style="width:${qrSize}px;height:${qrSize}px;">`;
        }
      });
    }

    /**
     * Build shared report URL from event data
     */
    function buildSharedReportUrlFromEvent(event) {
      if (!event || !event.links || !event.links.publicUrl) return '';
      // Report URL is typically publicUrl with page=report
      const publicUrl = event.links.publicUrl;
      return publicUrl.includes('?')
        ? publicUrl.replace(/page=[^&]+/, 'page=report')
        : publicUrl + '&page=report';
    }

    /**
     * Update Step 5 event summary
     */
    function updateWizardSummary() {
      const event = WIZARD.event;
      if (!event) return;

      const dateStr = event.startDateISO || '';
      const eventDate = new Date(dateStr + 'T00:00:00');
      let dateDisplay = dateStr;
      if (dateStr && !isNaN(eventDate.getTime())) {
        dateDisplay = eventDate.toLocaleDateString('en-US', {
          weekday: 'short', month: 'short', day: 'numeric'
        });
      }

      const summary = document.getElementById('wizardEventSummary');
      if (summary) {
        summary.textContent = `${event.name || 'Your Event'} ‚Ä¢ ${dateDisplay} ‚Ä¢ ${event.venue || ''}`;
      }
    }

    /**
     * Copy wizard link to clipboard
     */
    async function copyWizardLink(type) {
      const links = WIZARD.links;
      let url = '';

      switch (type) {
        case 'public': url = links.publicUrl; break;
        case 'poster': url = links.posterUrl; break;
        case 'display': url = links.displayUrl; break;
        case 'report': url = links.sharedReportUrl || buildSharedReportUrlFromEvent(WIZARD.event); break;
      }

      if (url) {
        await navigator.clipboard.writeText(url);
        SharedUtils.showToast('Link copied!', 'success');
      }
    }

    /**
     * Open wizard link in new tab
     */
    function openWizardLink(type) {
      const links = WIZARD.links;
      let url = '';

      switch (type) {
        case 'public': url = links.publicUrl; break;
        case 'poster': url = links.posterUrl; break;
        case 'display': url = links.displayUrl; break;
        case 'report': url = links.sharedReportUrl || buildSharedReportUrlFromEvent(WIZARD.event); break;
      }

      if (url) {
        window.open(url, '_blank');
      }
    }

    /**
     * Finish wizard and transition to main dashboard
     */
    function finishWizard() {
      // Hide wizard
      document.getElementById('launchWizard').style.display = 'none';

      // Show the event card with created event
      if (WIZARD.event) {
        currentEventId = WIZARD.event.id;
        showEventCard(WIZARD.event);
      }

      SharedUtils.showToast('Welcome to your event dashboard!', 'success');
    }

    // Initialize wizard when DOM is ready
    document.addEventListener('DOMContentLoaded', initWizard);
  </script>
</body>
</html>

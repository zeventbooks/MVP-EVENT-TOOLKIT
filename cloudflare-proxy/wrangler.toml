# Cloudflare Workers Configuration
# https://developers.cloudflare.com/workers/wrangler/configuration/

name = "eventangle"
main = "worker.js"
compatibility_date = "2024-01-01"

# Account ID - Set via environment or wrangler login
# account_id = "your-account-id"

# ============================================
# Environment Variables
# ============================================
# The deployment ID is updated by CI/CD after each Apps Script deployment
[vars]
DEPLOYMENT_ID = "AKfycbxaTPh3FS4NHJblIcUrz4k01kWAdxsKzLNnYRf0TXe18lBditTm3hqbBoQ4ZxbGhhGuCA"

# ============================================
# Production - FULL SITE (eventangle.com)
# ============================================
# This serves EVERYTHING through Cloudflare:
# - HTML pages (admin, public, display, etc.)
# - API responses (status, events, sponsors)
# - All brands (root, abc, cbc, cbl)
[env.production]
name = "eventangle-prod"
routes = [
  # Main domain - serves full site
  { pattern = "eventangle.com/*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/*", zone_name = "eventangle.com" },
  # API subdomain (optional, same worker)
  { pattern = "api.eventangle.com/*", zone_name = "eventangle.com" }
]

[env.production.vars]
DEPLOYMENT_ID = "AKfycbxaTPh3FS4NHJblIcUrz4k01kWAdxsKzLNnYRf0TXe18lBditTm3hqbBoQ4ZxbGhhGuCA"

# ============================================
# Staging/QA Environment
# ============================================
[env.staging]
name = "eventangle-staging"
routes = [
  { pattern = "staging.eventangle.com/*", zone_name = "eventangle.com" },
  { pattern = "api-staging.eventangle.com/*", zone_name = "eventangle.com" }
]

[env.staging.vars]
DEPLOYMENT_ID = "AKfycbxaTPh3FS4NHJblIcUrz4k01kWAdxsKzLNnYRf0TXe18lBditTm3hqbBoQ4ZxbGhhGuCA"

# ============================================
# API Only (subdomain only, no main site)
# ============================================
[env.api-only]
name = "eventangle-api"
routes = [
  { pattern = "api.eventangle.com/*", zone_name = "eventangle.com" }
]

[env.api-only.vars]
DEPLOYMENT_ID = "AKfycbxaTPh3FS4NHJblIcUrz4k01kWAdxsKzLNnYRf0TXe18lBditTm3hqbBoQ4ZxbGhhGuCA"

# ============================================
# Friendly URLs (all app paths on main site)
# ============================================
# Routes all friendly URL patterns through Cloudflare to GAS.
# See docs/FRIENDLY_URLS.md for complete URL mapping.
[env.events]
name = "eventangle-events"
routes = [
  # Google Apps Script static assets (CSS, JS) - redirect to Google CDN
  { pattern = "eventangle.com/static/*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/static/*", zone_name = "eventangle.com" },
  # Google internal endpoints (warden bot detection, error reporting) - stub responses
  { pattern = "eventangle.com/wardeninit*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/wardeninit*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/warden*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/warden*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/jserror*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/jserror*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/_/*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/_/*", zone_name = "eventangle.com" },
  # Global aliases
  { pattern = "eventangle.com/events*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/events*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/schedule*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/schedule*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/calendar*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/calendar*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/manage*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/manage*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/admin*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/admin*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/dashboard*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/dashboard*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/create*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/create*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/display*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/display*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/tv*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/tv*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/kiosk*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/kiosk*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/screen*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/screen*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/posters*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/posters*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/poster*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/poster*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/flyers*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/flyers*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/analytics*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/analytics*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/reports*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/reports*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/insights*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/insights*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/stats*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/stats*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/status*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/status*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/health*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/health*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/docs*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/docs*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/api*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/api*", zone_name = "eventangle.com" },
  # Brand-prefixed paths (abc, cbc, cbl)
  { pattern = "eventangle.com/abc/*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/abc/*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/cbc/*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/cbc/*", zone_name = "eventangle.com" },
  { pattern = "eventangle.com/cbl/*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/cbl/*", zone_name = "eventangle.com" },
  # Root brand paths
  { pattern = "eventangle.com/root/*", zone_name = "eventangle.com" },
  { pattern = "www.eventangle.com/root/*", zone_name = "eventangle.com" }
]

[env.events.vars]
# The full Google Apps Script exec URL - this is the production backend
# Update this URL after each Apps Script deployment (see DEPLOYMENT.md)
GAS_DEPLOYMENT_BASE_URL = "https://script.google.com/macros/s/AKfycbxaTPh3FS4NHJblIcUrz4k01kWAdxsKzLNnYRf0TXe18lBditTm3hqbBoQ4ZxbGhhGuCA/exec"
DEPLOYMENT_ID = "AKfycbxaTPh3FS4NHJblIcUrz4k01kWAdxsKzLNnYRf0TXe18lBditTm3hqbBoQ4ZxbGhhGuCA"

# ============================================
# Development (workers.dev subdomain)
# ============================================
# Default deployment uses workers.dev:
# https://eventangle.YOUR_SUBDOMAIN.workers.dev
#
# Test URLs:
# - https://eventangle.YOUR_SUBDOMAIN.workers.dev?page=admin&brand=root
# - https://eventangle.YOUR_SUBDOMAIN.workers.dev?p=status&brand=root
# - https://eventangle.YOUR_SUBDOMAIN.workers.dev?page=display&brand=root
